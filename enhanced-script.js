// ===== PROFESSIONAL POS SYSTEM =====
// Multi-language, Multi-currency, Multi-user with all professional features

// ===== CONFIGURATION & DATA =====

// Multi-language support (English, Arabic, French, Spanish)
const languages = {
    en: {
        welcome: 'Welcome to MyPOS',
        categories: 'Categories',
        products: 'Products',
        currentOrder: 'Current Order',
        subtotal: 'Subtotal',
        tax: 'Tax',
        total: 'Total',
        clearCart: 'Clear Cart',
        checkout: 'Checkout',
        emptyCart: 'No items in cart',
        allItems: 'All Items',
        food: 'Food',
        drinks: 'Drinks',
        snacks: 'Snacks',
        cashier: 'Cashier',
        admin: 'Admin',
        manager: 'Manager',
        login: 'Login',
        logout: 'Logout',
        username: 'Username',
        password: 'Password',
        lowStock: 'Low Stock Alert',
        printReceipt: 'Print Receipt',
        reports: 'Reports',
        inventory: 'Inventory',
        settings: 'Settings',
        currency: 'Currency',
        language: 'Language',
        sales: 'Sales',
        dashboard: 'Dashboard',
        users: 'Users',
        addProduct: 'Add Product',
        editProduct: 'Edit Product',
        deleteProduct: 'Delete Product',
        stock: 'Stock',
        price: 'Price',
        barcode: 'Barcode',
        category: 'Category',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        edit: 'Edit',
        add: 'Add',
        search: 'Search',
        filter: 'Filter',
        export: 'Export',
        import: 'Import',
        backup: 'Backup',
        restore: 'Restore',
        invoice: 'Invoice',
        receipt: 'Receipt',
        printInvoice: 'Print Invoice',
        lowStockReport: 'Low Stock Report',
        expiredItems: 'Expired Items',
        printLowStock: 'Print Low Stock',
        printExpired: 'Print Expired',
        productImage: 'Product Image',
        uploadImage: 'Upload Image',
        changeImage: 'Change Image',
        removeImage: 'Remove Image',
        expiryDate: 'Expiry Date',
        expired: 'Expired',
        nearExpiry: 'Near Expiry',
        supplier: 'Supplier',
        cost: 'Cost',
        profit: 'Profit',
        margin: 'Margin',
        todaysSales: 'Today\'s Sales',
        thisWeek: 'This Week',
        thisMonth: 'This Month',
        totalProducts: 'Total Products',
        transactions: 'Transactions',
        averageTransaction: 'Average Transaction',
        topSellingProducts: 'Top Selling Products',
        cashierPerformance: 'Cashier Performance',
        recentSales: 'Recent Sales',
        dailyReport: 'Daily Report',
        weeklyReport: 'Weekly Report',
        monthlyReport: 'Monthly Report',
        salesReport: 'Sales Report',
        inventoryReport: 'Inventory Report',
        profitReport: 'Profit Report',
        taxReport: 'Tax Report',
        customerReceipt: 'Customer Receipt',
        businessInvoice: 'Business Invoice',
        companyInfo: 'Company Information',
        customerInfo: 'Customer Information',
        itemsNeedRestocking: 'items need restocking',
        activeProducts: 'active products',
        outOfStock: 'Out of Stock',
        inStock: 'In Stock',
        lowStock: 'Low Stock',
        goodStock: 'Good Stock',
        description: 'Description',
        quantity: 'Quantity',
        time: 'Time',
        date: 'Date',
        summary: 'Summary',
        urgentAction: 'Urgent Action Required',
        restockImmediately: 'Restock these items immediately',
        productName: 'Product Name',
        currentStock: 'Current Stock',
        minimumStock: 'Minimum Stock',
        generatedBy: 'Generated by',
        printedOn: 'Printed on',
        noLowStockItems: 'No low stock items found',
        noExpiredItems: 'No expired or near-expiry items found',
        expiryStatus: 'Expiry Status',
        daysUntilExpiry: 'Days Until Expiry',
        daysOverdue: 'Days Overdue',
        scanBarcode: 'Scan Barcode',
        enterBarcode: 'Enter Barcode',
        useCamera: 'Use Camera',
        manualEntry: 'Manual Entry',
        connectScanner: 'Connect Scanner',
        pointCameraAtBarcode: 'Point camera at barcode',
        productAdded: 'Product Added',
        productNotFound: 'Product Not Found',
        scannerConnected: 'Scanner Connected',
        scannerDisconnected: 'Scanner Disconnected',
        cameraAccessError: 'Camera access denied or not available',
        totalSales: 'Total Sales',
        totalTransactions: 'Total Transactions',
        paymentMethod: 'Payment Method',
        companyLogo: 'Company Logo',
        uploadLogo: 'Upload Logo',
        removeLogo: 'Remove Logo',
        companySettings: 'Company Settings',
        logoSettings: 'Logo Settings',
        addProduct: 'Add Product',
        editProduct: 'Edit Product',
        allItems: 'All Items',
        emptyCart: 'Cart is empty',
        address: 'Address',
        phone: 'Phone',
        receiptFooter: 'Receipt Footer',
        recommendedSize: 'Recommended size',
        invalidFileType: 'Please select a valid image file (PNG, JPG, GIF)',
        fileTooLarge: 'File size must be less than 2MB',
        logoUpdated: 'Logo updated successfully!',
        confirmRemoveLogo: 'Are you sure you want to remove the company logo?',
        logoRemoved: 'Logo removed successfully!',
        addUser: 'Add User',
        exportUsers: 'Export Users',
        saveSettings: 'Save Settings',
        resetSettings: 'Reset to Defaults',
        exportData: 'Export Data',
        importData: 'Import Data',
        createBackup: 'Create Backup',
        clearAllData: 'Clear All Data',
        lowStockReport: 'Low Stock Report',
        inventoryExported: 'Inventory exported successfully!',
        reportsExported: 'Reports exported successfully!',
        usersExported: 'Users exported successfully!',
        accessDenied: 'Access denied',
        confirmResetSettings: 'Are you sure you want to reset all settings to defaults?',
        settingsReset: 'Settings reset to defaults successfully!',
        dataExported: 'Data exported successfully!',
        confirmImportData: 'This will replace current data. Are you sure?',
        dataImported: 'Data imported successfully!',
        importError: 'Import error',
        confirmClearAllData: 'WARNING: This will delete all products and sales data!',
        confirmClearAllDataFinal: 'FINAL WARNING: This action cannot be undone!',
        allDataCleared: 'All data cleared successfully!',
        username: 'Username',
        active: 'Active',
        inactive: 'Inactive',
        status: 'Status',
        allStockLevels: 'All Stock Levels',
        lowStockOnly: 'Low Stock Only',
        outOfStockOnly: 'Out of Stock Only',
        search: 'Search',
        selectPaymentMethod: 'Please select a payment method',
        insufficientStock: 'Insufficient stock',
        available: 'Available',
        saleCompleted: 'Sale completed',
        cardNumber: 'Card Number',
        cardAccess: 'Card Access',
        categories: 'Categories',
        categoryManagement: 'Category Management',
        addCategory: 'Add Category',
        editCategory: 'Edit Category',
        categoryName: 'Category Name',
        charts: 'Charts',
        salesChart: 'Sales Chart',
        productChart: 'Product Chart',
        dailySales: 'Daily Sales',
        weeklySales: 'Weekly Sales',
        monthlySales: 'Monthly Sales',
        category: 'Category',
        addedSuccessfully: 'added successfully',
        updatedSuccessfully: 'updated successfully',
        successfully: 'successfully',
        activated: 'activated',
        deactivated: 'deactivated',
        cannotDeleteCategory: 'Cannot delete category',
        productsUsingCategory: 'products using this category',
        confirmDeleteCategory: 'Are you sure you want to delete category',
        deletedSuccessfully: 'deleted successfully',
        categoriesExported: 'Categories exported successfully',
        productsSold: 'Products Sold',
        tools: 'Tools',
        hardware: 'Hardware',
        construction: 'Construction',
        electrical: 'Electrical',
        plumbing: 'Plumbing',
        accessDenied: 'Access Denied',
        noPermissionCategories: 'You don\'t have permission to manage categories.',
        topSellingProducts: 'Top Selling Products',
        minStock: 'Min Stock',
        supplier: 'Supplier',
        adjustStock: 'Adjust Stock',
        id: 'ID',
        notAvailable: 'N/A',
        report: 'Report',
        fullName: 'Full Name',
        newPassword: 'New Password (leave blank to keep current)',
        englishName: 'English Name',
        arabicName: 'Arabic Name',
        frenchName: 'French Name',
        spanishName: 'Spanish Name'
    },
    ar: {
        welcome: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ù€ MyPOS',
        categories: 'Ø§Ù„ÙØ¦Ø§Øª',
        products: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
        currentOrder: 'Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ',
        subtotal: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ',
        tax: 'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©',
        total: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹',
        clearCart: 'Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©',
        checkout: 'Ø§Ù„Ø¯ÙØ¹',
        emptyCart: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©',
        allItems: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±',
        food: 'Ø·Ø¹Ø§Ù…',
        drinks: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª',
        snacks: 'ÙˆØ¬Ø¨Ø§Øª Ø®ÙÙŠÙØ©',
        cashier: 'Ø£Ù…ÙŠÙ† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚',
        admin: 'Ù…Ø¯ÙŠØ±',
        manager: 'Ù…Ø¯ÙŠØ±',
        login: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        logout: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
        username: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        password: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
        lowStock: 'ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶',
        printReceipt: 'Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„',
        reports: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
        inventory: 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
        currency: 'Ø§Ù„Ø¹Ù…Ù„Ø©',
        language: 'Ø§Ù„Ù„ØºØ©',
        sales: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
        dashboard: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
        users: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†',
        addProduct: 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬',
        editProduct: 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬',
        deleteProduct: 'Ø­Ø°Ù Ù…Ù†ØªØ¬',
        stock: 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        price: 'Ø§Ù„Ø³Ø¹Ø±',
        barcode: 'Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯',
        category: 'Ø§Ù„ÙØ¦Ø©',
        save: 'Ø­ÙØ¸',
        cancel: 'Ø¥Ù„ØºØ§Ø¡',
        delete: 'Ø­Ø°Ù',
        edit: 'ØªØ¹Ø¯ÙŠÙ„',
        add: 'Ø¥Ø¶Ø§ÙØ©',
        search: 'Ø¨Ø­Ø«',
        filter: 'ØªØµÙÙŠØ©',
        export: 'ØªØµØ¯ÙŠØ±',
        import: 'Ø§Ø³ØªÙŠØ±Ø§Ø¯',
        backup: 'Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ',
        restore: 'Ø§Ø³ØªØ¹Ø§Ø¯Ø©',
        dinar: 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ',
        invoice: 'ÙØ§ØªÙˆØ±Ø©',
        receipt: 'Ø¥ÙŠØµØ§Ù„',
        printInvoice: 'Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø©',
        lowStockReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶',
        expiredItems: 'Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        printLowStock: 'Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶',
        printExpired: 'Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        productImage: 'ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬',
        uploadImage: 'Ø±ÙØ¹ ØµÙˆØ±Ø©',
        changeImage: 'ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©',
        removeImage: 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©',
        expiryDate: 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        expired: 'Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        nearExpiry: 'Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        supplier: 'Ø§Ù„Ù…ÙˆØ±Ø¯',
        cost: 'Ø§Ù„ØªÙƒÙ„ÙØ©',
        profit: 'Ø§Ù„Ø±Ø¨Ø­',
        margin: 'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­',
        todaysSales: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…',
        thisWeek: 'Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹',
        thisMonth: 'Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±',
        totalProducts: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
        transactions: 'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª',
        averageTransaction: 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©',
        topSellingProducts: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹',
        cashierPerformance: 'Ø£Ø¯Ø§Ø¡ Ø£Ù…Ù†Ø§Ø¡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚',
        recentSales: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©',
        dailyReport: 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ',
        weeklyReport: 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ',
        monthlyReport: 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ',
        salesReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
        inventoryReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        profitReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­',
        taxReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨',
        customerReceipt: 'Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„',
        businessInvoice: 'ÙØ§ØªÙˆØ±Ø© ØªØ¬Ø§Ø±ÙŠØ©',
        companyInfo: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©',
        customerInfo: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„',
        itemsNeedRestocking: 'Ø¹Ù†Ø§ØµØ± ØªØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ®Ø²ÙŠÙ†',
        activeProducts: 'Ù…Ù†ØªØ¬Ø§Øª Ù†Ø´Ø·Ø©',
        outOfStock: 'Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        inStock: 'Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        lowStock: 'Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶',
        goodStock: 'Ù…Ø®Ø²ÙˆÙ† Ø¬ÙŠØ¯',
        description: 'Ø§Ù„ÙˆØµÙ',
        quantity: 'Ø§Ù„ÙƒÙ…ÙŠØ©',
        time: 'Ø§Ù„ÙˆÙ‚Øª',
        date: 'Ø§Ù„ØªØ§Ø±ÙŠØ®',
        summary: 'Ø§Ù„Ù…Ù„Ø®Øµ',
        urgentAction: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ø§Ø¬Ù„ Ù…Ø·Ù„ÙˆØ¨',
        restockImmediately: 'Ø£Ø¹Ø¯ ØªØ®Ø²ÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙˆØ±Ø§Ù‹',
        productName: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬',
        currentStock: 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ',
        minimumStock: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†',
        generatedBy: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø©',
        printedOn: 'Ø·ÙØ¨Ø¹ ÙÙŠ',
        noLowStockItems: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶',
        noExpiredItems: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø£Ùˆ Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        expiryStatus: 'Ø­Ø§Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        daysUntilExpiry: 'Ø£ÙŠØ§Ù… Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
        daysOverdue: 'Ø£ÙŠØ§Ù… Ù…ØªØ£Ø®Ø±Ø©',
        scanBarcode: 'Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯',
        enterBarcode: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯',
        useCamera: 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§',
        manualEntry: 'Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ',
        connectScanner: 'Ø±Ø¨Ø· Ø§Ù„Ù…Ø§Ø³Ø­',
        pointCameraAtBarcode: 'ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯',
        productAdded: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬',
        productNotFound: 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
        scannerConnected: 'Ø§Ù„Ù…Ø§Ø³Ø­ Ù…ØªØµÙ„',
        scannerDisconnected: 'Ø§Ù„Ù…Ø§Ø³Ø­ ØºÙŠØ± Ù…ØªØµÙ„',
        cameraAccessError: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­Ø©',
        totalSales: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
        totalTransactions: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª',
        paymentMethod: 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹',
        companyLogo: 'Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©',
        uploadLogo: 'Ø±ÙØ¹ Ø´Ø¹Ø§Ø±',
        removeLogo: 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø¹Ø§Ø±',
        companySettings: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©',
        logoSettings: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¹Ø§Ø±',
        addProduct: 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬',
        editProduct: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬',
        allItems: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±',
        emptyCart: 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©',
        address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
        phone: 'Ø§Ù„Ù‡Ø§ØªÙ',
        receiptFooter: 'ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„',
        recommendedSize: 'Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ÙÙˆØµÙ‰ Ø¨Ù‡',
        invalidFileType: 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ§Ù„Ø­ (PNG, JPG, GIF)',
        fileTooLarge: 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø£Ù‚Ù„ Ù…Ù† 2 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª',
        logoUpdated: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!',
        confirmRemoveLogo: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©ØŸ',
        logoRemoved: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!',
        addUser: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…',
        exportUsers: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
        saveSettings: 'Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
        resetSettings: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ',
        exportData: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        importData: 'Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        createBackup: 'Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©',
        clearAllData: 'Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        lowStockReport: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶',
        inventoryExported: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­!',
        reportsExported: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!',
        usersExported: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!',
        accessDenied: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„',
        confirmResetSettings: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŸ',
        settingsReset: 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ù†Ø¬Ø§Ø­!',
        dataExported: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!',
        confirmImportData: 'Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        dataImported: 'ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!',
        importError: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯',
        confirmClearAllData: 'ØªØ­Ø°ÙŠØ±: Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª!',
        confirmClearAllDataFinal: 'ØªØ­Ø°ÙŠØ± Ø£Ø®ÙŠØ±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!',
        allDataCleared: 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!',
        username: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        active: 'Ù†Ø´Ø·',
        inactive: 'ØºÙŠØ± Ù†Ø´Ø·',
        status: 'Ø§Ù„Ø­Ø§Ù„Ø©',
        allStockLevels: 'Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        lowStockOnly: 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶ ÙÙ‚Ø·',
        outOfStockOnly: 'Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙ‚Ø·',
        search: 'Ø¨Ø­Ø«',
        selectPaymentMethod: 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹',
        insufficientStock: 'Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ',
        available: 'Ù…ØªÙˆÙØ±',
        saleCompleted: 'ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹',
        cardNumber: 'Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
        cardAccess: 'Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
        categories: 'Ø§Ù„ÙØ¦Ø§Øª',
        categoryManagement: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª',
        addCategory: 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©',
        editCategory: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ¦Ø©',
        categoryName: 'Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©',
        charts: 'Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©',
        salesChart: 'Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
        productChart: 'Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª',
        dailySales: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©',
        weeklySales: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©',
        monthlySales: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©',
        category: 'Ø§Ù„ÙØ¦Ø©',
        addedSuccessfully: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­',
        updatedSuccessfully: 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­',
        successfully: 'Ø¨Ù†Ø¬Ø§Ø­',
        activated: 'ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„',
        deactivated: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„',
        cannotDeleteCategory: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©',
        productsUsingCategory: 'Ù…Ù†ØªØ¬Ø§Øª ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©',
        confirmDeleteCategory: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©',
        deletedSuccessfully: 'ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­',
        categoriesExported: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ¦Ø§Øª Ø¨Ù†Ø¬Ø§Ø­',
        productsSold: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©',
        tools: 'Ø£Ø¯ÙˆØ§Øª',
        hardware: 'Ø£Ø¬Ù‡Ø²Ø©',
        construction: 'Ø¨Ù†Ø§Ø¡',
        electrical: 'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ',
        plumbing: 'Ø³Ø¨Ø§ÙƒØ©',
        accessDenied: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„',
        noPermissionCategories: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¥Ø°Ù† Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª.',
        topSellingProducts: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹',
        minStock: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†',
        supplier: 'Ø§Ù„Ù…ÙˆØ±Ø¯',
        adjustStock: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        id: 'Ø§Ù„Ù…Ø¹Ø±Ù',
        notAvailable: 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
        report: 'ØªÙ‚Ø±ÙŠØ±',
        fullName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
        newPassword: 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø© (Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø­Ø§Ù„ÙŠØ©)',
        englishName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ',
        arabicName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ',
        frenchName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙØ±Ù†Ø³ÙŠ',
        spanishName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠ'
    },
    fr: {
        welcome: 'Bienvenue Ã  MyPOS',
        categories: 'CatÃ©gories',
        products: 'Produits',
        currentOrder: 'Commande Actuelle',
        subtotal: 'Sous-total',
        tax: 'Taxe',
        total: 'Total',
        clearCart: 'Vider le Panier',
        checkout: 'Paiement',
        emptyCart: 'Aucun article dans le panier',
        allItems: 'Tous les Articles',
        food: 'Nourriture',
        drinks: 'Boissons',
        snacks: 'Collations',
        cashier: 'Caissier',
        admin: 'Administrateur',
        manager: 'Gestionnaire',
        login: 'Connexion',
        logout: 'DÃ©connexion',
        username: 'Nom d\'utilisateur',
        password: 'Mot de passe',
        lowStock: 'Alerte Stock Faible',
        printReceipt: 'Imprimer ReÃ§u',
        reports: 'Rapports',
        inventory: 'Inventaire',
        settings: 'ParamÃ¨tres',
        currency: 'Devise',
        language: 'Langue',
        sales: 'Ventes',
        dashboard: 'Tableau de Bord',
        users: 'Utilisateurs',
        addProduct: 'Ajouter Produit',
        editProduct: 'Modifier Produit',
        deleteProduct: 'Supprimer Produit',
        stock: 'Stock',
        price: 'Prix',
        barcode: 'Code-barres',
        category: 'CatÃ©gorie',
        save: 'Enregistrer',
        cancel: 'Annuler',
        delete: 'Supprimer',
        edit: 'Modifier',
        add: 'Ajouter',
        search: 'Rechercher',
        filter: 'Filtrer',
        export: 'Exporter',
        import: 'Importer',
        backup: 'Sauvegarde',
        restore: 'Restaurer',
        invoice: 'Facture',
        receipt: 'ReÃ§u',
        printInvoice: 'Imprimer Facture',
        lowStockReport: 'Rapport Stock Faible',
        expiredItems: 'Articles ExpirÃ©s',
        printLowStock: 'Imprimer Stock Faible',
        printExpired: 'Imprimer ExpirÃ©s',
        productImage: 'Image Produit',
        uploadImage: 'TÃ©lÃ©charger Image',
        changeImage: 'Changer Image',
        removeImage: 'Supprimer Image',
        expiryDate: 'Date d\'Expiration',
        expired: 'ExpirÃ©',
        nearExpiry: 'Proche Expiration',
        supplier: 'Fournisseur',
        cost: 'CoÃ»t',
        profit: 'Profit',
        margin: 'Marge',
        todaysSales: 'Ventes d\'Aujourd\'hui',
        thisWeek: 'Cette Semaine',
        thisMonth: 'Ce Mois',
        totalProducts: 'Total Produits',
        transactions: 'Transactions',
        averageTransaction: 'Transaction Moyenne',
        topSellingProducts: 'Produits les Plus Vendus',
        cashierPerformance: 'Performance Caissiers',
        recentSales: 'Ventes RÃ©centes',
        dailyReport: 'Rapport Quotidien',
        weeklyReport: 'Rapport Hebdomadaire',
        monthlyReport: 'Rapport Mensuel',
        salesReport: 'Rapport des Ventes',
        inventoryReport: 'Rapport d\'Inventaire',
        profitReport: 'Rapport de Profit',
        taxReport: 'Rapport de Taxes',
        customerReceipt: 'ReÃ§u Client',
        businessInvoice: 'Facture Commerciale',
        companyInfo: 'Informations SociÃ©tÃ©',
        customerInfo: 'Informations Client',
        itemsNeedRestocking: 'articles nÃ©cessitent rÃ©approvisionnement',
        activeProducts: 'produits actifs',
        outOfStock: 'Rupture de Stock',
        inStock: 'En Stock',
        lowStock: 'Stock Faible',
        goodStock: 'Bon Stock',
        description: 'Description',
        quantity: 'QuantitÃ©',
        time: 'Heure',
        date: 'Date',
        summary: 'RÃ©sumÃ©',
        urgentAction: 'Action Urgente Requise',
        restockImmediately: 'RÃ©approvisionner ces articles immÃ©diatement',
        productName: 'Nom du Produit',
        currentStock: 'Stock Actuel',
        minimumStock: 'Stock Minimum',
        generatedBy: 'GÃ©nÃ©rÃ© par',
        printedOn: 'ImprimÃ© le',
        noLowStockItems: 'Aucun article en stock faible trouvÃ©',
        noExpiredItems: 'Aucun article expirÃ© ou proche de l\'expiration trouvÃ©',
        expiryStatus: 'Statut d\'Expiration',
        daysUntilExpiry: 'Jours Jusqu\'Ã  Expiration',
        daysOverdue: 'Jours de Retard',
        totalSales: 'Ventes Totales',
        totalTransactions: 'Transactions Totales',
        paymentMethod: 'MÃ©thode de Paiement',
        companyLogo: 'Logo de l\'Entreprise',
        uploadLogo: 'TÃ©lÃ©charger Logo',
        removeLogo: 'Supprimer Logo',
        companySettings: 'ParamÃ¨tres Entreprise',
        logoSettings: 'ParamÃ¨tres Logo',
        addProduct: 'Ajouter Produit',
        editProduct: 'Modifier Produit',
        allItems: 'Tous les Articles',
        emptyCart: 'Panier vide',
        address: 'Adresse',
        phone: 'TÃ©lÃ©phone',
        receiptFooter: 'Pied de Page ReÃ§u',
        recommendedSize: 'Taille recommandÃ©e',
        invalidFileType: 'Veuillez sÃ©lectionner un fichier image valide (PNG, JPG, GIF)',
        fileTooLarge: 'La taille du fichier doit Ãªtre infÃ©rieure Ã  2 Mo',
        logoUpdated: 'Logo mis Ã  jour avec succÃ¨s!',
        confirmRemoveLogo: 'ÃŠtes-vous sÃ»r de vouloir supprimer le logo de l\'entreprise?',
        logoRemoved: 'Logo supprimÃ© avec succÃ¨s!',
        addUser: 'Ajouter Utilisateur',
        exportUsers: 'Exporter Utilisateurs',
        saveSettings: 'Sauvegarder ParamÃ¨tres',
        resetSettings: 'RÃ©initialiser par DÃ©faut',
        exportData: 'Exporter DonnÃ©es',
        importData: 'Importer DonnÃ©es',
        createBackup: 'CrÃ©er Sauvegarde',
        clearAllData: 'Effacer Toutes DonnÃ©es',
        lowStockReport: 'Rapport Stock Faible',
        inventoryExported: 'Inventaire exportÃ© avec succÃ¨s!',
        reportsExported: 'Rapports exportÃ©s avec succÃ¨s!',
        usersExported: 'Utilisateurs exportÃ©s avec succÃ¨s!',
        accessDenied: 'AccÃ¨s refusÃ©',
        confirmResetSettings: 'ÃŠtes-vous sÃ»r de vouloir rÃ©initialiser tous les paramÃ¨tres par dÃ©faut?',
        settingsReset: 'ParamÃ¨tres rÃ©initialisÃ©s par dÃ©faut avec succÃ¨s!',
        dataExported: 'DonnÃ©es exportÃ©es avec succÃ¨s!',
        confirmImportData: 'Cela remplacera les donnÃ©es actuelles. ÃŠtes-vous sÃ»r?',
        dataImported: 'DonnÃ©es importÃ©es avec succÃ¨s!',
        importError: 'Erreur d\'importation',
        confirmClearAllData: 'ATTENTION: Cela supprimera tous les produits et donnÃ©es de vente!',
        confirmClearAllDataFinal: 'DERNIER AVERTISSEMENT: Cette action ne peut pas Ãªtre annulÃ©e!',
        allDataCleared: 'Toutes les donnÃ©es effacÃ©es avec succÃ¨s!',
        username: 'Nom d\'utilisateur',
        active: 'Actif',
        inactive: 'Inactif',
        status: 'Statut',
        allStockLevels: 'Tous Niveaux de Stock',
        lowStockOnly: 'Stock Faible Seulement',
        outOfStockOnly: 'Rupture de Stock Seulement',
        search: 'Rechercher',
        selectPaymentMethod: 'Veuillez sÃ©lectionner un mode de paiement',
        insufficientStock: 'Stock insuffisant',
        available: 'Disponible',
        saleCompleted: 'Vente terminÃ©e',
        cardNumber: 'NumÃ©ro de Carte',
        cardAccess: 'AccÃ¨s par Carte',
        categories: 'CatÃ©gories',
        categoryManagement: 'Gestion des CatÃ©gories',
        addCategory: 'Ajouter CatÃ©gorie',
        editCategory: 'Modifier CatÃ©gorie',
        categoryName: 'Nom de CatÃ©gorie',
        charts: 'Graphiques',
        salesChart: 'Graphique des Ventes',
        productChart: 'Graphique des Produits',
        dailySales: 'Ventes Quotidiennes',
        weeklySales: 'Ventes Hebdomadaires',
        monthlySales: 'Ventes Mensuelles',
        category: 'CatÃ©gorie',
        addedSuccessfully: 'ajoutÃ© avec succÃ¨s',
        updatedSuccessfully: 'mis Ã  jour avec succÃ¨s',
        successfully: 'avec succÃ¨s',
        activated: 'activÃ©',
        deactivated: 'dÃ©sactivÃ©',
        cannotDeleteCategory: 'Impossible de supprimer la catÃ©gorie',
        productsUsingCategory: 'produits utilisant cette catÃ©gorie',
        confirmDeleteCategory: 'ÃŠtes-vous sÃ»r de vouloir supprimer la catÃ©gorie',
        deletedSuccessfully: 'supprimÃ© avec succÃ¨s',
        categoriesExported: 'CatÃ©gories exportÃ©es avec succÃ¨s',
        productsSold: 'Produits Vendus',
        tools: 'Outils',
        hardware: 'Quincaillerie',
        construction: 'Construction',
        electrical: 'Ã‰lectrique',
        plumbing: 'Plomberie',
        accessDenied: 'AccÃ¨s RefusÃ©',
        noPermissionCategories: 'Vous n\'avez pas la permission de gÃ©rer les catÃ©gories.',
        topSellingProducts: 'Produits les Plus Vendus',
        minStock: 'Stock Minimum',
        supplier: 'Fournisseur',
        adjustStock: 'Ajuster Stock',
        id: 'ID',
        notAvailable: 'N/D',
        report: 'Rapport',
        fullName: 'Nom Complet',
        newPassword: 'Nouveau Mot de Passe (laisser vide pour conserver actuel)',
        englishName: 'Nom Anglais',
        arabicName: 'Nom Arabe',
        frenchName: 'Nom FranÃ§ais',
        spanishName: 'Nom Espagnol'
    },
    es: {
        welcome: 'Bienvenido a MyPOS',
        categories: 'CategorÃ­as',
        products: 'Productos',
        currentOrder: 'Pedido Actual',
        subtotal: 'Subtotal',
        tax: 'Impuesto',
        total: 'Total',
        clearCart: 'Limpiar Carrito',
        checkout: 'Pagar',
        emptyCart: 'No hay artÃ­culos en el carrito',
        allItems: 'Todos los ArtÃ­culos',
        food: 'Comida',
        drinks: 'Bebidas',
        snacks: 'Aperitivos',
        cashier: 'Cajero',
        admin: 'Administrador',
        manager: 'Gerente',
        login: 'Iniciar SesiÃ³n',
        logout: 'Cerrar SesiÃ³n',
        username: 'Usuario',
        password: 'ContraseÃ±a',
        lowStock: 'Alerta Stock Bajo',
        printReceipt: 'Imprimir Recibo',
        reports: 'Informes',
        inventory: 'Inventario',
        settings: 'ConfiguraciÃ³n',
        currency: 'Moneda',
        language: 'Idioma',
        sales: 'Ventas',
        dashboard: 'Panel de Control',
        users: 'Usuarios',
        addProduct: 'Agregar Producto',
        editProduct: 'Editar Producto',
        deleteProduct: 'Eliminar Producto',
        stock: 'Stock',
        price: 'Precio',
        barcode: 'CÃ³digo de Barras',
        category: 'CategorÃ­a',
        save: 'Guardar',
        cancel: 'Cancelar',
        delete: 'Eliminar',
        edit: 'Editar',
        add: 'Agregar',
        search: 'Buscar',
        filter: 'Filtrar',
        export: 'Exportar',
        import: 'Importar',
        backup: 'Respaldo',
        restore: 'Restaurar',
        invoice: 'Factura',
        receipt: 'Recibo',
        printInvoice: 'Imprimir Factura',
        lowStockReport: 'Reporte Stock Bajo',
        expiredItems: 'ArtÃ­culos Vencidos',
        printLowStock: 'Imprimir Stock Bajo',
        printExpired: 'Imprimir Vencidos',
        productImage: 'Imagen Producto',
        uploadImage: 'Subir Imagen',
        changeImage: 'Cambiar Imagen',
        removeImage: 'Quitar Imagen',
        expiryDate: 'Fecha de Vencimiento',
        expired: 'Vencido',
        nearExpiry: 'PrÃ³ximo a Vencer',
        supplier: 'Proveedor',
        cost: 'Costo',
        profit: 'Ganancia',
        margin: 'Margen',
        todaysSales: 'Ventas de Hoy',
        thisWeek: 'Esta Semana',
        thisMonth: 'Este Mes',
        totalProducts: 'Total Productos',
        transactions: 'Transacciones',
        averageTransaction: 'TransacciÃ³n Promedio',
        topSellingProducts: 'Productos MÃ¡s Vendidos',
        cashierPerformance: 'Rendimiento Cajeros',
        recentSales: 'Ventas Recientes',
        dailyReport: 'Reporte Diario',
        weeklyReport: 'Reporte Semanal',
        monthlyReport: 'Reporte Mensual',
        salesReport: 'Reporte de Ventas',
        inventoryReport: 'Reporte de Inventario',
        profitReport: 'Reporte de Ganancias',
        taxReport: 'Reporte de Impuestos',
        customerReceipt: 'Recibo Cliente',
        businessInvoice: 'Factura Comercial',
        companyInfo: 'InformaciÃ³n Empresa',
        customerInfo: 'InformaciÃ³n Cliente',
        itemsNeedRestocking: 'artÃ­culos necesitan reabastecimiento',
        activeProducts: 'productos activos',
        outOfStock: 'Sin Stock',
        inStock: 'En Stock',
        lowStock: 'Stock Bajo',
        goodStock: 'Buen Stock',
        description: 'DescripciÃ³n',
        quantity: 'Cantidad',
        time: 'Hora',
        date: 'Fecha',
        summary: 'Resumen',
        urgentAction: 'AcciÃ³n Urgente Requerida',
        restockImmediately: 'Reabastecer estos artÃ­culos inmediatamente',
        productName: 'Nombre del Producto',
        currentStock: 'Stock Actual',
        minimumStock: 'Stock MÃ­nimo',
        generatedBy: 'Generado por',
        printedOn: 'Impreso el',
        noLowStockItems: 'No se encontraron artÃ­culos con stock bajo',
        noExpiredItems: 'No se encontraron artÃ­culos vencidos o prÃ³ximos a vencer',
        expiryStatus: 'Estado de Vencimiento',
        daysUntilExpiry: 'DÃ­as Hasta Vencimiento',
        daysOverdue: 'DÃ­as Vencidos',
        totalSales: 'Ventas Totales',
        totalTransactions: 'Transacciones Totales',
        paymentMethod: 'MÃ©todo de Pago',
        companyLogo: 'Logo de la Empresa',
        uploadLogo: 'Subir Logo',
        removeLogo: 'Quitar Logo',
        companySettings: 'ConfiguraciÃ³n Empresa',
        logoSettings: 'ConfiguraciÃ³n Logo',
        addProduct: 'Agregar Producto',
        editProduct: 'Editar Producto',
        allItems: 'Todos los ArtÃ­culos',
        emptyCart: 'Carrito vacÃ­o',
        address: 'DirecciÃ³n',
        phone: 'TelÃ©fono',
        receiptFooter: 'Pie de PÃ¡gina Recibo',
        recommendedSize: 'TamaÃ±o recomendado',
        invalidFileType: 'Por favor seleccione un archivo de imagen vÃ¡lido (PNG, JPG, GIF)',
        fileTooLarge: 'El tamaÃ±o del archivo debe ser menor a 2MB',
        logoUpdated: 'Â¡Logo actualizado exitosamente!',
        confirmRemoveLogo: 'Â¿EstÃ¡ seguro de que desea eliminar el logo de la empresa?',
        logoRemoved: 'Â¡Logo eliminado exitosamente!',
        addUser: 'Agregar Usuario',
        exportUsers: 'Exportar Usuarios',
        saveSettings: 'Guardar ConfiguraciÃ³n',
        resetSettings: 'Restablecer por Defecto',
        exportData: 'Exportar Datos',
        importData: 'Importar Datos',
        createBackup: 'Crear Respaldo',
        clearAllData: 'Limpiar Todos los Datos',
        lowStockReport: 'Reporte Stock Bajo',
        inventoryExported: 'Â¡Inventario exportado exitosamente!',
        reportsExported: 'Â¡Reportes exportados exitosamente!',
        usersExported: 'Â¡Usuarios exportados exitosamente!',
        accessDenied: 'Acceso denegado',
        confirmResetSettings: 'Â¿EstÃ¡ seguro de que desea restablecer toda la configuraciÃ³n por defecto?',
        settingsReset: 'Â¡ConfiguraciÃ³n restablecida por defecto exitosamente!',
        dataExported: 'Â¡Datos exportados exitosamente!',
        confirmImportData: 'Esto reemplazarÃ¡ los datos actuales. Â¿EstÃ¡ seguro?',
        dataImported: 'Â¡Datos importados exitosamente!',
        importError: 'Error de importaciÃ³n',
        confirmClearAllData: 'ADVERTENCIA: Â¡Esto eliminarÃ¡ todos los productos y datos de ventas!',
        confirmClearAllDataFinal: 'ADVERTENCIA FINAL: Â¡Esta acciÃ³n no se puede deshacer!',
        allDataCleared: 'Â¡Todos los datos eliminados exitosamente!',
        username: 'Usuario',
        active: 'Activo',
        inactive: 'Inactivo',
        status: 'Estado',
        allStockLevels: 'Todos Niveles de Stock',
        lowStockOnly: 'Solo Stock Bajo',
        outOfStockOnly: 'Solo Sin Stock',
        search: 'Buscar',
        selectPaymentMethod: 'Por favor seleccione un mÃ©todo de pago',
        insufficientStock: 'Stock insuficiente',
        available: 'Disponible',
        saleCompleted: 'Venta completada',
        cardNumber: 'NÃºmero de Tarjeta',
        cardAccess: 'Acceso con Tarjeta',
        categories: 'CategorÃ­as',
        categoryManagement: 'GestiÃ³n de CategorÃ­as',
        addCategory: 'Agregar CategorÃ­a',
        editCategory: 'Editar CategorÃ­a',
        categoryName: 'Nombre de CategorÃ­a',
        charts: 'GrÃ¡ficos',
        salesChart: 'GrÃ¡fico de Ventas',
        productChart: 'GrÃ¡fico de Productos',
        dailySales: 'Ventas Diarias',
        weeklySales: 'Ventas Semanales',
        monthlySales: 'Ventas Mensuales',
        category: 'CategorÃ­a',
        addedSuccessfully: 'agregado exitosamente',
        updatedSuccessfully: 'actualizado exitosamente',
        successfully: 'exitosamente',
        activated: 'activado',
        deactivated: 'desactivado',
        cannotDeleteCategory: 'No se puede eliminar la categorÃ­a',
        productsUsingCategory: 'productos usando esta categorÃ­a',
        confirmDeleteCategory: 'Â¿EstÃ¡ seguro de que desea eliminar la categorÃ­a',
        deletedSuccessfully: 'eliminado exitosamente',
        categoriesExported: 'CategorÃ­as exportadas exitosamente',
        productsSold: 'Productos Vendidos',
        tools: 'Herramientas',
        hardware: 'FerreterÃ­a',
        construction: 'ConstrucciÃ³n',
        electrical: 'ElÃ©ctrico',
        plumbing: 'FontanerÃ­a',
        accessDenied: 'Acceso Denegado',
        noPermissionCategories: 'No tienes permiso para gestionar categorÃ­as.',
        topSellingProducts: 'Productos MÃ¡s Vendidos',
        minStock: 'Stock MÃ­nimo',
        supplier: 'Proveedor',
        adjustStock: 'Ajustar Stock',
        id: 'ID',
        notAvailable: 'N/D',
        report: 'Reporte',
        fullName: 'Nombre Completo',
        newPassword: 'Nueva ContraseÃ±a (dejar en blanco para mantener actual)',
        englishName: 'Nombre en InglÃ©s',
        arabicName: 'Nombre en Ãrabe',
        frenchName: 'Nombre en FrancÃ©s',
        spanishName: 'Nombre en EspaÃ±ol'
    }
};

// Multi-currency support including Algerian Dinar with language-specific names
const currencies = {
    USD: {
        symbol: '$',
        rate: 1.0,
        names: {
            en: 'US Dollar',
            ar: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ',
            fr: 'Dollar AmÃ©ricain',
            es: 'DÃ³lar Estadounidense'
        }
    },
    EUR: {
        symbol: 'â‚¬',
        rate: 0.85,
        names: {
            en: 'Euro',
            ar: 'ÙŠÙˆØ±Ùˆ',
            fr: 'Euro',
            es: 'Euro'
        }
    },
    AED: {
        symbol: 'Ø¯.Ø¥',
        rate: 3.67,
        names: {
            en: 'UAE Dirham',
            ar: 'Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ',
            fr: 'Dirham des EAU',
            es: 'Dirham de EAU'
        }
    },
    SAR: {
        symbol: 'Ø±.Ø³',
        rate: 3.75,
        names: {
            en: 'Saudi Riyal',
            ar: 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ',
            fr: 'Riyal Saoudien',
            es: 'Riyal SaudÃ­'
        }
    },
    DZD: {
        symbol: { en: 'Ø¯.Ø¬', ar: 'Ø¯.Ø¬', fr: 'DA', es: 'DA' },
        rate: 134.5,
        names: {
            en: 'Algerian Dinar',
            ar: 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ',
            fr: 'Dinar AlgÃ©rien',
            es: 'Dinar Argelino'
        }
    },
    GBP: {
        symbol: 'Â£',
        rate: 0.73,
        names: {
            en: 'British Pound',
            ar: 'Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ',
            fr: 'Livre Sterling',
            es: 'Libra Esterlina'
        }
    },
    MAD: {
        symbol: 'Ø¯.Ù…',
        rate: 10.2,
        names: {
            en: 'Moroccan Dirham',
            ar: 'Ø¯Ø±Ù‡Ù… Ù…ØºØ±Ø¨ÙŠ',
            fr: 'Dirham Marocain',
            es: 'Dirham MarroquÃ­'
        }
    },
    TND: {
        symbol: 'Ø¯.Øª',
        rate: 3.1,
        names: {
            en: 'Tunisian Dinar',
            ar: 'Ø¯ÙŠÙ†Ø§Ø± ØªÙˆÙ†Ø³ÙŠ',
            fr: 'Dinar Tunisien',
            es: 'Dinar Tunecino'
        }
    }
};

// User roles and permissions
const userRoles = {
    admin: {
        name: 'Admin',
        permissions: ['all']
    },
    manager: {
        name: 'Manager', 
        permissions: ['sales', 'inventory', 'reports', 'users', 'settings']
    },
    cashier: {
        name: 'Cashier',
        permissions: ['sales', 'basic_reports']
    }
};

// Sample users with card access (in production, this would be in a secure database)
const users = [
    { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator', active: true, cardNumber: '1001', cardAccess: true },
    { id: 2, username: 'manager', password: 'manager123', role: 'manager', name: 'Store Manager', active: true, cardNumber: '1002', cardAccess: true },
    { id: 3, username: 'cashier1', password: 'cashier123', role: 'cashier', name: 'Ahmed Ali', active: true, cardNumber: '1003', cardAccess: true },
    { id: 4, username: 'cashier2', password: 'cashier123', role: 'cashier', name: 'Fatima Hassan', active: true, cardNumber: '1004', cardAccess: true },
    { id: 5, username: 'cashier3', password: 'cashier123', role: 'cashier', name: 'Omar Benali', active: true, cardNumber: '1005', cardAccess: false }
];

// Categories management - Enhanced for hardware store
let categories = JSON.parse(localStorage.getItem('categories')) || [
    { id: 1, name: 'Food', nameAr: 'Ø·Ø¹Ø§Ù…', nameFr: 'Nourriture', nameEs: 'Comida', active: true },
    { id: 2, name: 'Drinks', nameAr: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', nameFr: 'Boissons', nameEs: 'Bebidas', active: true },
    { id: 3, name: 'Snacks', nameAr: 'ÙˆØ¬Ø¨Ø§Øª Ø®ÙÙŠÙØ©', nameFr: 'Collations', nameEs: 'Aperitivos', active: true },
    { id: 4, name: 'Tools', nameAr: 'Ø£Ø¯ÙˆØ§Øª', nameFr: 'Outils', nameEs: 'Herramientas', active: true },
    { id: 5, name: 'Hardware', nameAr: 'Ø£Ø¬Ù‡Ø²Ø©', nameFr: 'Quincaillerie', nameEs: 'FerreterÃ­a', active: true },
    { id: 6, name: 'Construction', nameAr: 'Ø¨Ù†Ø§Ø¡', nameFr: 'Construction', nameEs: 'ConstrucciÃ³n', active: true },
    { id: 7, name: 'Electrical', nameAr: 'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', nameFr: 'Ã‰lectrique', nameEs: 'ElÃ©ctrico', active: true },
    { id: 8, name: 'Plumbing', nameAr: 'Ø³Ø¨Ø§ÙƒØ©', nameFr: 'Plomberie', nameEs: 'FontanerÃ­a', active: true }
];

// Enhanced product data with full inventory management, images, and expiry dates
const products = [
    {
        id: 1, name: 'Hamburger', nameAr: 'Ù‡Ù…Ø¨Ø±ØºØ±', nameFr: 'Hamburger', nameEs: 'Hamburguesa',
        price: 8.99, category: 'food', stock: 25, minStock: 5, maxStock: 100,
        barcode: '1234567890123', supplier: 'Food Corp', cost: 5.50, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkY2QjM1Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ”</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 7 days from now
    },
    {
        id: 2, name: 'Cheeseburger', nameAr: 'ØªØ´ÙŠØ² Ø¨Ø±ØºØ±', nameFr: 'Cheeseburger', nameEs: 'Hamburguesa con Queso',
        price: 9.99, category: 'food', stock: 20, minStock: 5, maxStock: 80,
        barcode: '1234567890124', supplier: 'Food Corp', cost: 6.20, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZENzAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ§€ğŸ”</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 5 days from now
    },
    {
        id: 3, name: 'French Fries', nameAr: 'Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ù„ÙŠØ©', nameFr: 'Frites', nameEs: 'Papas Fritas',
        price: 3.99, category: 'food', stock: 50, minStock: 10, maxStock: 200,
        barcode: '1234567890125', supplier: 'Food Corp', cost: 1.80, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZBNTAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸŸ</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 3 days from now
    },
    {
        id: 4, name: 'Chicken Wings', nameAr: 'Ø£Ø¬Ù†Ø­Ø© Ø¯Ø¬Ø§Ø¬', nameFr: 'Ailes de Poulet', nameEs: 'Alitas de Pollo',
        price: 12.99, category: 'food', stock: 15, minStock: 5, maxStock: 60,
        barcode: '1234567890126', supplier: 'Poultry Plus', cost: 8.50, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjOEI0NTEzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ—</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 2 days from now (near expiry)
    },
    {
        id: 5, name: 'Caesar Salad', nameAr: 'Ø³Ù„Ø·Ø© Ù‚ÙŠØµØ±', nameFr: 'Salade CÃ©sar', nameEs: 'Ensalada CÃ©sar',
        price: 7.99, category: 'food', stock: 12, minStock: 5, maxStock: 40,
        barcode: '1234567890127', supplier: 'Fresh Greens', cost: 4.20, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzJDRDMyIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ¥—</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 1 day from now (near expiry)
    },
    {
        id: 6, name: 'Coca Cola', nameAr: 'ÙƒÙˆÙƒØ§ ÙƒÙˆÙ„Ø§', nameFr: 'Coca Cola', nameEs: 'Coca Cola',
        price: 2.99, category: 'drinks', stock: 100, minStock: 20, maxStock: 500,
        barcode: '1234567890128', supplier: 'Beverage Co', cost: 1.50, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjREMyNjI2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ¥¤</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 1 year from now
    },
    {
        id: 7, name: 'Orange Juice', nameAr: 'Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„', nameFr: 'Jus d\'Orange', nameEs: 'Jugo de Naranja',
        price: 3.49, category: 'drinks', stock: 30, minStock: 10, maxStock: 150,
        barcode: '1234567890129', supplier: 'Juice Factory', cost: 2.10, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZBNTAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸŠ</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 14 days from now
    },
    {
        id: 8, name: 'Coffee', nameAr: 'Ù‚Ù‡ÙˆØ©', nameFr: 'CafÃ©', nameEs: 'CafÃ©',
        price: 2.49, category: 'drinks', stock: 80, minStock: 15, maxStock: 300,
        barcode: '1234567890130', supplier: 'Coffee Roasters', cost: 1.20, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkY0RTM3Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+â˜•</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 6 months from now
    },
    {
        id: 9, name: 'Water Bottle', nameAr: 'Ø²Ø¬Ø§Ø¬Ø© Ù…Ø§Ø¡', nameFr: 'Bouteille d\'Eau', nameEs: 'Botella de Agua',
        price: 1.99, category: 'drinks', stock: 200, minStock: 50, maxStock: 1000,
        barcode: '1234567890131', supplier: 'Pure Water', cost: 0.80, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDA5NkZGIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ’§</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 730 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 2 years from now
    },
    {
        id: 10, name: 'Potato Chips', nameAr: 'Ø±Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¨Ø·Ø§Ø·Ø³', nameFr: 'Chips de Pomme de Terre', nameEs: 'Papas Fritas',
        price: 2.99, category: 'snacks', stock: 3, minStock: 10, maxStock: 200,
        barcode: '1234567890132', supplier: 'Snack Foods', cost: 1.50, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZENzAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ¥”</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 3 months from now
    },
    {
        id: 11, name: 'Chocolate Bar', nameAr: 'Ù„ÙˆØ­ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', nameFr: 'Barre de Chocolat', nameEs: 'Barra de Chocolate',
        price: 1.99, category: 'snacks', stock: 45, minStock: 15, maxStock: 150,
        barcode: '1234567890133', supplier: 'Sweet Treats', cost: 1.10, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjOEI0NTEzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ«</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() + 120 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 4 months from now
    },
    {
        id: 12, name: 'Cookies', nameAr: 'ÙƒÙˆÙƒÙŠØ²', nameFr: 'Biscuits', nameEs: 'Galletas',
        price: 3.49, category: 'snacks', stock: 2, minStock: 8, maxStock: 100,
        barcode: '1234567890134', supplier: 'Bakery Plus', cost: 2.00, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRDI2OTFFIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸª</dGV4dD4KPC9zdmc+',
        expiryDate: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 1 day ago (expired)
    },

    // ===== HARDWARE PRODUCTS - ALGERIA MARKET =====

    // TOOLS CATEGORY
    {
        id: 13, name: 'Hammer', nameAr: 'Ù…Ø·Ø±Ù‚Ø©', nameFr: 'Marteau', nameEs: 'Martillo',
        price: 1250, category: 'tools', stock: 25, minStock: 5, maxStock: 100,
        barcode: '2001001001', supplier: 'Algeria Tools Co', cost: 850, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjOEI0NTEzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ”¨</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 14, name: 'Screwdriver Set', nameAr: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ÙÙƒØ§Øª', nameFr: 'Jeu de Tournevis', nameEs: 'Juego de Destornilladores',
        price: 850, category: 'tools', stock: 40, minStock: 10, maxStock: 150,
        barcode: '2001001002', supplier: 'Algeria Tools Co', cost: 580, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDY5MEU3Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸª›</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 15, name: 'Wrench Set', nameAr: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ÙØ§ØªÙŠØ­ Ø±Ø¨Ø·', nameFr: 'Jeu de ClÃ©s', nameEs: 'Juego de Llaves',
        price: 1450, category: 'tools', stock: 30, minStock: 8, maxStock: 120,
        barcode: '2001001003', supplier: 'Algeria Tools Co', cost: 980, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkM3NTdEIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ”§</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 16, name: 'Drill Bits Set', nameAr: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ù‚Ù… Ø§Ù„Ø­ÙØ±', nameFr: 'Jeu de Forets', nameEs: 'Juego de Brocas',
        price: 750, category: 'tools', stock: 50, minStock: 15, maxStock: 200,
        barcode: '2001001004', supplier: 'Algeria Tools Co', cost: 480, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzQ0OTVFIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸªš</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 17, name: 'Measuring Tape', nameAr: 'Ø´Ø±ÙŠØ· Ù‚ÙŠØ§Ø³', nameFr: 'MÃ¨tre Ruban', nameEs: 'Cinta MÃ©trica',
        price: 450, category: 'tools', stock: 60, minStock: 20, maxStock: 250,
        barcode: '2001001005', supplier: 'Algeria Tools Co', cost: 280, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZENzAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ“</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },

    // HARDWARE CATEGORY
    {
        id: 18, name: 'Wood Screws 4x50mm (100pcs)', nameAr: 'Ø¨Ø±Ø§ØºÙŠ Ø®Ø´Ø¨ 4Ã—50Ù…Ù… (100 Ù‚Ø·Ø¹Ø©)', nameFr: 'Vis Ã  Bois 4x50mm (100pcs)', nameEs: 'Tornillos para Madera 4x50mm (100pcs)',
        price: 320, category: 'hardware', stock: 200, minStock: 50, maxStock: 1000,
        barcode: '2002001001', supplier: 'Algerian Hardware Supply', cost: 180, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkM3NTdEIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ”©</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 19, name: 'Metal Bolts M8x40mm (50pcs)', nameAr: 'Ø¨Ø±Ø§ØºÙŠ Ù…Ø¹Ø¯Ù†ÙŠØ© M8Ã—40Ù…Ù… (50 Ù‚Ø·Ø¹Ø©)', nameFr: 'Boulons MÃ©tal M8x40mm (50pcs)', nameEs: 'Pernos de Metal M8x40mm (50pcs)',
        price: 580, category: 'hardware', stock: 150, minStock: 30, maxStock: 800,
        barcode: '2002001002', supplier: 'Algerian Hardware Supply', cost: 350, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDk1MDU3Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+âš™ï¸</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 20, name: 'Nails 3 inch (1kg)', nameAr: 'Ù…Ø³Ø§Ù…ÙŠØ± 3 Ø¨ÙˆØµØ© (1 ÙƒÙŠÙ„Ùˆ)', nameFr: 'Clous 3 pouces (1kg)', nameEs: 'Clavos 3 pulgadas (1kg)',
        price: 420, category: 'hardware', stock: 80, minStock: 20, maxStock: 400,
        barcode: '2002001003', supplier: 'Algerian Hardware Supply', cost: 250, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjOEI0NTEzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ“Œ</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 21, name: 'Washers Assorted (200pcs)', nameAr: 'Ø­Ù„Ù‚Ø§Øª Ù…Ø¹Ø¯Ù†ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø© (200 Ù‚Ø·Ø¹Ø©)', nameFr: 'Rondelles Assorties (200pcs)', nameEs: 'Arandelas Surtidas (200pcs)',
        price: 280, category: 'hardware', stock: 120, minStock: 25, maxStock: 600,
        barcode: '2002001004', supplier: 'Algerian Hardware Supply', cost: 160, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkM3NTdEIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+â­•</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 22, name: 'Hinges 3 inch (pair)', nameAr: 'Ù…ÙØµÙ„Ø§Øª 3 Ø¨ÙˆØµØ© (Ø²ÙˆØ¬)', nameFr: 'CharniÃ¨res 3 pouces (paire)', nameEs: 'Bisagras 3 pulgadas (par)',
        price: 650, category: 'hardware', stock: 45, minStock: 10, maxStock: 200,
        barcode: '2002001005', supplier: 'Algerian Hardware Supply', cost: 420, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDk1MDU3Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸšª</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },

    // CONSTRUCTION CATEGORY
    {
        id: 23, name: 'Cement 50kg Bag', nameAr: 'ÙƒÙŠØ³ Ø¥Ø³Ù…Ù†Øª 50 ÙƒÙŠÙ„Ùˆ', nameFr: 'Sac de Ciment 50kg', nameEs: 'Bolsa de Cemento 50kg',
        price: 850, category: 'construction', stock: 100, minStock: 20, maxStock: 500,
        barcode: '2003001001', supplier: 'Algeria Construction Materials', cost: 650, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkM3NTdEIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ—ï¸</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 24, name: 'Sand 25kg Bag', nameAr: 'ÙƒÙŠØ³ Ø±Ù…Ù„ 25 ÙƒÙŠÙ„Ùˆ', nameFr: 'Sac de Sable 25kg', nameEs: 'Bolsa de Arena 25kg',
        price: 320, category: 'construction', stock: 150, minStock: 30, maxStock: 800,
        barcode: '2003001002', supplier: 'Algeria Construction Materials', cost: 220, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjRBNDYwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸ–ï¸</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 25, name: 'Bricks (per piece)', nameAr: 'Ø·ÙˆØ¨ (Ø§Ù„Ù‚Ø·Ø¹Ø©)', nameFr: 'Briques (Ã  l\'unitÃ©)', nameEs: 'Ladrillos (por pieza)',
        price: 45, category: 'construction', stock: 500, minStock: 100, maxStock: 2000,
        barcode: '2003001003', supplier: 'Algeria Construction Materials', cost: 28, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjQ0Q1QzVDIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ğŸ§±</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 26, name: 'Steel Rebar 12mm (6m)', nameAr: 'Ø­Ø¯ÙŠØ¯ ØªØ³Ù„ÙŠØ­ 12Ù…Ù… (6 Ù…ØªØ±)', nameFr: 'Fer Ã  BÃ©ton 12mm (6m)', nameEs: 'Varilla de Acero 12mm (6m)',
        price: 1850, category: 'construction', stock: 80, minStock: 15, maxStock: 300,
        barcode: '2003001004', supplier: 'Algeria Steel Co', cost: 1420, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDk1MDU3Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸ”—</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },

    // ELECTRICAL CATEGORY
    {
        id: 27, name: 'Electrical Wire 2.5mm (100m)', nameAr: 'Ø³Ù„Ùƒ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ 2.5Ù…Ù… (100 Ù…ØªØ±)', nameFr: 'Fil Ã‰lectrique 2.5mm (100m)', nameEs: 'Cable ElÃ©ctrico 2.5mm (100m)',
        price: 2850, category: 'electrical', stock: 35, minStock: 8, maxStock: 150,
        barcode: '2004001001', supplier: 'Algeria Electric Supply', cost: 2100, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZENzAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">âš¡</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 28, name: 'Light Switch', nameAr: 'Ù…ÙØªØ§Ø­ Ø¥Ø¶Ø§Ø¡Ø©', nameFr: 'Interrupteur', nameEs: 'Interruptor de Luz',
        price: 180, category: 'electrical', stock: 120, minStock: 25, maxStock: 500,
        barcode: '2004001002', supplier: 'Algeria Electric Supply', cost: 110, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjhGOUZBIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJibGFjayIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸ’¡</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 29, name: 'Power Outlet', nameAr: 'Ù…Ù‚Ø¨Ø³ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', nameFr: 'Prise Ã‰lectrique', nameEs: 'Toma de Corriente',
        price: 220, category: 'electrical', stock: 90, minStock: 20, maxStock: 400,
        barcode: '2004001003', supplier: 'Algeria Electric Supply', cost: 140, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjhGOUZBIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJibGFjayIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸ”Œ</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },

    // PLUMBING CATEGORY
    {
        id: 30, name: 'PVC Pipe 32mm (3m)', nameAr: 'Ø£Ù†Ø¨ÙˆØ¨ PVC 32Ù…Ù… (3 Ù…ØªØ±)', nameFr: 'Tuyau PVC 32mm (3m)', nameEs: 'Tubo PVC 32mm (3m)',
        price: 380, category: 'plumbing', stock: 75, minStock: 15, maxStock: 300,
        barcode: '2005001001', supplier: 'Algeria Plumbing Co', cost: 250, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjhGOUZBIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJibGFjayIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸš°</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 31, name: 'Pipe Fittings Set', nameAr: 'Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØµÙ„Ø§Øª Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨', nameFr: 'Jeu de Raccords', nameEs: 'Juego de Accesorios',
        price: 650, category: 'plumbing', stock: 55, minStock: 12, maxStock: 250,
        barcode: '2005001002', supplier: 'Algeria Plumbing Co', cost: 420, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNkM3NTdEIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸ”§</dGV4dD4KPC9zdmc+',
        expiryDate: null
    },
    {
        id: 32, name: 'Faucet Standard', nameAr: 'ØµÙ†Ø¨ÙˆØ± Ø¹Ø§Ø¯ÙŠ', nameFr: 'Robinet Standard', nameEs: 'Grifo EstÃ¡ndar',
        price: 1250, category: 'plumbing', stock: 25, minStock: 5, maxStock: 100,
        barcode: '2005001003', supplier: 'Algeria Plumbing Co', cost: 850, active: true,
        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNEZBNEZGIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI">ğŸš¿</dGV4dD4KPC9zdmc+',
        expiryDate: null
    }
];

// ===== GLOBAL STATE =====
let cart = [];
let currentCategory = 'all';
let currentUser = null;
let currentLanguage = localStorage.getItem('posLanguage') || 'en';
let currentCurrency = localStorage.getItem('posCurrency') || 'USD';
let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
let isLoggedIn = false;
let currentView = 'pos'; // pos, inventory, reports, settings, users

// System settings
const settings = {
    taxRate: parseFloat(localStorage.getItem('taxRate')) || 0.19, // 19% VAT (Algeria standard)
    companyName: localStorage.getItem('companyName') || 'My POS System',
    companyAddress: localStorage.getItem('companyAddress') || 'Algiers, Algeria',
    companyPhone: localStorage.getItem('companyPhone') || '+213 21 123 456',
    receiptFooter: localStorage.getItem('receiptFooter') || 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… - Thank you for your visit!',
    companyLogo: localStorage.getItem('companyLogo') || '',
    lowStockThreshold: parseInt(localStorage.getItem('lowStockThreshold')) || 10,
    autoBackup: localStorage.getItem('autoBackup') === 'true',
    printAfterSale: localStorage.getItem('printAfterSale') === 'true',
    showBarcode: localStorage.getItem('showBarcode') === 'true'
};

// ===== UTILITY FUNCTIONS =====

// Get translated text
function t(key) {
    return languages[currentLanguage][key] || key;
}

// Get product name in current language
function getProductName(product) {
    switch(currentLanguage) {
        case 'ar': return product.nameAr || product.name;
        case 'fr': return product.nameFr || product.name;
        case 'es': return product.nameEs || product.name;
        default: return product.name;
    }
}

// Format currency with language-specific symbols
function formatCurrency(amount) {
    const currency = currencies[currentCurrency];
    const convertedAmount = amount * currency.rate;

    // Get language-specific symbol
    let symbol;
    if (typeof currency.symbol === 'object') {
        symbol = currency.symbol[currentLanguage] || currency.symbol.en;
    } else {
        symbol = currency.symbol;
    }

    // Format based on language
    if (currentLanguage === 'ar') {
        return `${convertedAmount.toFixed(2)} ${symbol}`;
    } else {
        return `${symbol}${convertedAmount.toFixed(2)}`;
    }
}

// Get currency name in current language
function getCurrencyName(currencyCode) {
    const currency = currencies[currencyCode];
    return currency.names[currentLanguage] || currency.names.en;
}

// Convert price to current currency
function convertPrice(price) {
    return price * currencies[currentCurrency].rate;
}

// Generate unique ID
function generateId() {
    return Date.now() + Math.random().toString(36).substr(2, 9);
}

// Save to localStorage
function saveToStorage(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
        console.error('Failed to save to localStorage:', e);
    }
}

// Load from localStorage
function loadFromStorage(key, defaultValue = null) {
    try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
    } catch (e) {
        console.error('Failed to load from localStorage:', e);
        return defaultValue;
    }
}

// ===== AUTHENTICATION SYSTEM =====

function showLoginScreen() {
    const loginHTML = `
        <div class="login-screen">
            <div class="login-container">
                <div class="login-header">
                    <h1>${t('welcome')}</h1>
                    <div class="language-selector">
                        <label>Choose Language / Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:</label>
                        <select id="login-language" onchange="changeLanguage(this.value)">
                            <option value="en" ${currentLanguage === 'en' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ English</option>
                            <option value="ar" ${currentLanguage === 'ar' ? 'selected' : ''}>ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</option>
                            <option value="fr" ${currentLanguage === 'fr' ? 'selected' : ''}>ğŸ‡«ğŸ‡· FranÃ§ais (French)</option>
                            <option value="es" ${currentLanguage === 'es' ? 'selected' : ''}>ğŸ‡ªğŸ‡¸ EspaÃ±ol (Spanish)</option>
                        </select>
                    </div>
                </div>
                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="username">${t('username')}:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">${t('password')}:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">${t('login')}</button>
                </form>
                <div class="demo-users">
                    <h3>Demo Users:</h3>
                    <p><strong>Admin:</strong> admin / admin123</p>
                    <p><strong>Manager:</strong> manager / manager123</p>
                    <p><strong>Cashier:</strong> cashier1 / cashier123</p>
                </div>
            </div>
        </div>
    `;
    
    document.body.innerHTML = loginHTML;
    
    // Add login screen styles
    const loginStyles = `
        <style>
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-width: 400px;
            text-align: center;
        }
        .login-header {
            margin-bottom: 30px;
        }
        .login-header h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .language-selector select {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .login-form {
            text-align: left;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        .demo-users {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }
        .demo-users h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .demo-users p {
            margin: 5px 0;
            font-size: 14px;
        }
        </style>
    `;
    
    document.head.insertAdjacentHTML('beforeend', loginStyles);
}

function handleLogin(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    const user = users.find(u => u.username === username && u.password === password && u.active);
    
    if (user) {
        currentUser = user;
        isLoggedIn = true;
        localStorage.setItem('currentUser', JSON.stringify(user));
        localStorage.setItem('isLoggedIn', 'true');
        
        // Reload the page to initialize the main system
        location.reload();
    } else {
        alert('Invalid username or password');
    }
}

function logout() {
    currentUser = null;
    isLoggedIn = false;
    localStorage.removeItem('currentUser');
    localStorage.removeItem('isLoggedIn');
    location.reload();
}

function checkLoginStatus() {
    const savedUser = localStorage.getItem('currentUser');
    const savedLoginStatus = localStorage.getItem('isLoggedIn');
    
    if (savedUser && savedLoginStatus === 'true') {
        currentUser = JSON.parse(savedUser);
        isLoggedIn = true;
    }
}

// ===== LANGUAGE & CURRENCY FUNCTIONS =====

function changeLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('posLanguage', lang);

    if (isLoggedIn) {
        updateLanguage();
        displayProducts();
        updateCartDisplay();

        // Refresh current view content
        switch(currentView) {
            case 'inventory':
                loadInventoryView();
                break;
            case 'reports':
                loadReportsView();
                break;
            case 'users':
                loadUsersView();
                break;
            case 'settings':
                loadSettingsView();
                break;
        }

        // Update currency selector
        updateCurrencySelector();

        // Update low stock alerts
        checkLowStock();
    } else {
        // Just update the login screen
        showLoginScreen();
    }
}

function changeCurrency(currency) {
    currentCurrency = currency;
    localStorage.setItem('posCurrency', currency);
    displayProducts();
    updateCartDisplay();

    // Refresh current view if it contains currency data
    if (currentView === 'reports') {
        loadReportsView();
    }
}

function updateCurrencySelector() {
    const currencySelector = document.getElementById('currency-selector');
    if (currencySelector) {
        currencySelector.innerHTML = Object.entries(currencies).map(([code, curr]) => {
            const symbol = typeof curr.symbol === 'object' ? curr.symbol[currentLanguage] || curr.symbol.en : curr.symbol;
            const name = curr.names[currentLanguage] || curr.names.en;
            return `<option value="${code}" ${currentCurrency === code ? 'selected' : ''}>${symbol} ${name}</option>`;
        }).join('');
    }
}

function updateLanguage() {
    // Update all text elements with translations
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const translatedText = t(key);

        // Handle different element types
        if (element.tagName === 'INPUT' && element.type === 'button') {
            element.value = translatedText;
        } else if (element.tagName === 'INPUT' && element.placeholder) {
            element.placeholder = translatedText;
        } else if (element.tagName === 'BUTTON') {
            element.textContent = translatedText;
        } else {
            element.textContent = translatedText;
        }
    });

    // Update document direction for Arabic
    document.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
    document.documentElement.lang = currentLanguage;

    // Update language selector
    const languageSelector = document.getElementById('language-selector');
    if (languageSelector) {
        languageSelector.value = currentLanguage;
    }

    // Update currency selector with translated names
    updateCurrencySelector();
}

// ===== MAIN SYSTEM INITIALIZATION =====

document.addEventListener('DOMContentLoaded', function() {
    initializeSystem();
});

function initializeSystem() {
    checkLoginStatus();

    if (!isLoggedIn) {
        showLoginScreen();
        return;
    }

    // Initialize main system
    loadSettings();
    createMainInterface();
    updateLanguage();
    displayProducts();
    updateCartDisplay();
    updateTime();
    checkLowStock();

    // Set up intervals
    setInterval(updateTime, 1000);
    setInterval(checkLowStock, 60000); // Check every minute
    setInterval(autoSave, 30000); // Auto-save every 30 seconds

    // Event listeners
    setupEventListeners();

    console.log('Professional POS System initialized successfully');
}

function createMainInterface() {
    const mainHTML = `
        <div class="pos-container">
            <!-- Top Navigation -->
            <nav class="top-nav">
                <div class="nav-left">
                    <div id="main-logo" style="display: inline-flex; align-items: center;">
                        ${settings.companyLogo ?
                            `<img src="${settings.companyLogo}" alt="${settings.companyName}" style="max-height: 40px; margin-right: 15px;">` :
                            `<span style="font-weight: bold; color: var(--primary-color); margin-right: 15px;">${settings.companyName}</span>`
                        }
                    </div>
                    <h1 data-translate="welcome">${t('welcome')}</h1>
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="switchView('pos')" data-translate="sales">${t('sales')}</button>
                        ${hasPermission('inventory') ? `<button class="nav-tab" onclick="switchView('inventory')" data-translate="inventory">${t('inventory')}</button>` : ''}
                        ${hasPermission('inventory') ? `<button class="nav-tab" onclick="switchView('categories')" data-translate="categories">${t('categories')}</button>` : ''}
                        ${hasPermission('reports') ? `<button class="nav-tab" onclick="switchView('reports')" data-translate="reports">${t('reports')}</button>` : ''}
                        ${hasPermission('users') ? `<button class="nav-tab" onclick="switchView('users')" data-translate="users">${t('users')}</button>` : ''}
                        ${hasPermission('settings') ? `<button class="nav-tab" onclick="switchView('settings')" data-translate="settings">${t('settings')}</button>` : ''}
                    </div>
                </div>
                <div class="nav-right">
                    <div class="controls">
                        <div class="control-group">
                            <label>Language:</label>
                            <select id="language-selector" onchange="changeLanguage(this.value)">
                                <option value="en" ${currentLanguage === 'en' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ English</option>
                                <option value="ar" ${currentLanguage === 'ar' ? 'selected' : ''}>ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="fr" ${currentLanguage === 'fr' ? 'selected' : ''}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                <option value="es" ${currentLanguage === 'es' ? 'selected' : ''}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Currency:</label>
                            <select id="currency-selector" onchange="changeCurrency(this.value)">
                                ${Object.entries(currencies).map(([code, curr]) =>
                                    `<option value="${code}" ${currentCurrency === code ? 'selected' : ''}>${curr.symbol} ${curr.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>
                    <div class="user-info">
                        <span class="user-name">${currentUser.name} (${t(currentUser.role)})</span>
                        <span id="current-time"></span>
                        <button class="btn btn-secondary" onclick="logout()" data-translate="logout">${t('logout')}</button>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- POS View -->
                <div id="pos-view" class="view active">
                    <div class="pos-layout">
                        <!-- Categories & Search -->
                        <section class="categories-section">
                            <div class="search-bar">
                                <input type="text" id="product-search" placeholder="${t('search')}..." onkeyup="searchProducts()">
                                <button onclick="scanBarcode()" class="btn btn-secondary">ğŸ“· Scan</button>
                            </div>
                            <h2 data-translate="categories">${t('categories')}</h2>
                            <div class="category-buttons">
                                <button class="category-btn active" data-category="all" data-translate="allItems">${t('allItems')}</button>
                                <button class="category-btn" data-category="food" data-translate="food">${t('food')}</button>
                                <button class="category-btn" data-category="drinks" data-translate="drinks">${t('drinks')}</button>
                                <button class="category-btn" data-category="snacks" data-translate="snacks">${t('snacks')}</button>
                                <button class="category-btn" data-category="tools" data-translate="tools">${t('tools')}</button>
                                <button class="category-btn" data-category="hardware" data-translate="hardware">${t('hardware')}</button>
                                <button class="category-btn" data-category="construction" data-translate="construction">${t('construction')}</button>
                                <button class="category-btn" data-category="electrical" data-translate="electrical">${t('electrical')}</button>
                                <button class="category-btn" data-category="plumbing" data-translate="plumbing">${t('plumbing')}</button>
                            </div>
                            <div class="low-stock-alert" id="low-stock-alert" style="display: none;">
                                <h3 data-translate="lowStock">${t('lowStock')}</h3>
                                <div id="low-stock-items"></div>
                            </div>
                        </section>

                        <!-- Products Grid -->
                        <section class="products-section">
                            <h2 data-translate="products">${t('products')}</h2>
                            <div class="products-grid" id="products-grid">
                                <!-- Products will be loaded here -->
                            </div>
                        </section>

                        <!-- Shopping Cart -->
                        <section class="cart-section">
                            <h2 data-translate="currentOrder">${t('currentOrder')}</h2>
                            <div class="cart-items" id="cart-items">
                                <p class="empty-cart" data-translate="emptyCart">${t('emptyCart')}</p>
                            </div>
                            <div class="cart-summary">
                                <div class="total-line">
                                    <span data-translate="subtotal">${t('subtotal')}:</span>
                                    <span id="subtotal">${formatCurrency(0)}</span>
                                </div>
                                <div class="total-line">
                                    <span data-translate="tax">${t('tax')} (${(settings.taxRate * 100).toFixed(0)}%):</span>
                                    <span id="tax">${formatCurrency(0)}</span>
                                </div>
                                <div class="total-line total">
                                    <span data-translate="total">${t('total')}:</span>
                                    <span id="total">${formatCurrency(0)}</span>
                                </div>
                            </div>
                            <div class="cart-actions">
                                <button class="btn btn-secondary" id="clear-cart" data-translate="clearCart">${t('clearCart')}</button>
                                <button class="btn btn-success" id="print-receipt" data-translate="printReceipt">${t('printReceipt')}</button>
                                <button class="btn btn-info" id="print-invoice" data-translate="printInvoice">${t('printInvoice')}</button>
                                <button class="btn btn-primary" id="checkout" data-translate="checkout">${t('checkout')}</button>
                            </div>
                            <div class="management-actions" style="margin-top: 15px;">
                                <button class="btn btn-warning btn-small" onclick="printLowStockReport()" data-translate="printLowStock">${t('printLowStock')}</button>
                                <button class="btn btn-danger btn-small" onclick="printExpiredItemsReport()" data-translate="printExpired">${t('printExpired')}</button>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Other views will be added here -->
                <div id="inventory-view" class="view" style="display: none;">
                    <h2 data-translate="inventory">${t('inventory')}</h2>
                    <div class="inventory-content">
                        <!-- Inventory management will be added -->
                    </div>
                </div>

                <div id="categories-view" class="view" style="display: none;">
                    <h2 data-translate="categoryManagement">${t('categoryManagement')}</h2>
                    <div class="categories-content">
                        <!-- Categories management will be loaded here -->
                    </div>
                </div>

                <div id="reports-view" class="view" style="display: none;">
                    <h2 data-translate="reports">${t('reports')}</h2>
                    <div class="reports-content">
                        <!-- Reports will be added -->
                    </div>
                </div>

                <div id="users-view" class="view" style="display: none;">
                    <h2 data-translate="users">${t('users')}</h2>
                    <div class="users-content">
                        <!-- User management will be added -->
                    </div>
                </div>

                <div id="settings-view" class="view" style="display: none;">
                    <h2 data-translate="settings">${t('settings')}</h2>
                    <div class="settings-content">
                        <!-- Settings will be added -->
                    </div>
                </div>
            </main>
        </div>

        <!-- Checkout Modal -->
        <div class="modal" id="checkout-modal">
            <div class="modal-content">
                <h2 data-translate="checkout">${t('checkout')}</h2>
                <div class="checkout-summary">
                    <div class="checkout-items" id="checkout-items"></div>
                    <div class="checkout-total">
                        <h3><span data-translate="total">${t('total')}</span>: <span id="checkout-total-amount"></span></h3>
                    </div>
                </div>
                <div class="payment-methods">
                    <h3>Payment Method:</h3>
                    <button class="payment-btn" data-method="cash">ğŸ’µ Cash</button>
                    <button class="payment-btn" data-method="card">ğŸ’³ Card</button>
                    <button class="payment-btn" data-method="digital">ğŸ“± Digital</button>
                </div>
                <div class="payment-details" id="payment-details">
                    <!-- Payment details will be shown here -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-checkout" data-translate="cancel">${t('cancel')}</button>
                    <button class="btn btn-primary" id="complete-sale">Complete Sale</button>
                </div>
            </div>
        </div>
    `;

    document.body.innerHTML = mainHTML;
}

// ===== PERMISSION SYSTEM =====

function hasPermission(permission) {
    if (!currentUser) return false;
    const userRole = userRoles[currentUser.role];
    return userRole.permissions.includes('all') || userRole.permissions.includes(permission);
}

// ===== VIEW MANAGEMENT =====

function switchView(viewName) {
    // Hide all views
    document.querySelectorAll('.view').forEach(view => {
        view.style.display = 'none';
    });

    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected view
    const targetView = document.getElementById(`${viewName}-view`);
    if (targetView) {
        targetView.style.display = 'block';
        currentView = viewName;
    }

    // Add active class to selected tab
    event.target.classList.add('active');

    // Load view-specific content
    switch(viewName) {
        case 'inventory':
            loadInventoryView();
            break;
        case 'categories':
            loadCategoriesView();
            break;
        case 'reports':
            loadReportsView();
            break;
        case 'users':
            loadUsersView();
            break;
        case 'settings':
            loadSettingsView();
            break;
    }
}

// ===== INVENTORY MANAGEMENT =====

function loadInventoryView() {
    const inventoryView = document.getElementById('inventory-view');
    inventoryView.innerHTML = `
        <div class="inventory-header">
            <h2 data-translate="inventory">${t('inventory')}</h2>
            <div class="inventory-actions">
                <button class="btn btn-primary" onclick="showAddProductModal()" data-translate="addProduct">${t('addProduct')}</button>
                <button class="btn btn-secondary" onclick="exportInventory()" data-translate="export">${t('export')}</button>
                <button class="btn btn-warning" onclick="printLowStockReport()" data-translate="lowStockReport">${t('lowStockReport')}</button>
            </div>
        </div>

        <div class="inventory-filters">
            <input type="text" id="inventory-search" placeholder="${t('search')}..." onkeyup="filterInventory()">
            <select id="category-filter" onchange="filterInventory()">
                <option value="all">${t('allItems')}</option>
                <option value="food">${t('food')}</option>
                <option value="drinks">${t('drinks')}</option>
                <option value="snacks">${t('snacks')}</option>
                <option value="tools">${t('tools')}</option>
                <option value="hardware">${t('hardware')}</option>
                <option value="construction">${t('construction')}</option>
                <option value="electrical">${t('electrical')}</option>
                <option value="plumbing">${t('plumbing')}</option>
            </select>
            <select id="stock-filter" onchange="filterInventory()">
                <option value="all" data-translate="allStockLevels">${t('allStockLevels')}</option>
                <option value="low" data-translate="lowStockOnly">${t('lowStockOnly')}</option>
                <option value="out" data-translate="outOfStockOnly">${t('outOfStockOnly')}</option>
            </select>
        </div>

        <div class="inventory-table">
            <table>
                <thead>
                    <tr>
                        <th data-translate="name">${t('name')}</th>
                        <th data-translate="category">${t('category')}</th>
                        <th data-translate="price">${t('price')}</th>
                        <th data-translate="stock">${t('stock')}</th>
                        <th data-translate="minStock">${t('minStock')}</th>
                        <th data-translate="barcode">${t('barcode')}</th>
                        <th data-translate="supplier">${t('supplier')}</th>
                        <th data-translate="actions">${t('actions')}</th>
                    </tr>
                </thead>
                <tbody id="inventory-tbody">
                    ${generateInventoryRows()}
                </tbody>
            </table>
        </div>
    `;
}

function generateInventoryRows() {
    return products.map(product => {
        const productName = currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name;
        const isLowStock = product.stock <= product.minStock;
        const isOutOfStock = product.stock === 0;

        return `
            <tr class="${isOutOfStock ? 'out-of-stock' : isLowStock ? 'low-stock' : ''}">
                <td>${productName}</td>
                <td>${t(product.category)}</td>
                <td>${formatCurrency(product.price)}</td>
                <td>
                    <span class="stock-level ${isOutOfStock ? 'out' : isLowStock ? 'low' : 'normal'}">
                        ${product.stock}
                    </span>
                </td>
                <td>${product.minStock}</td>
                <td>${product.barcode}</td>
                <td>${product.supplier || t('notAvailable')}</td>
                <td class="actions">
                    <button class="btn-small btn-primary" onclick="editProduct(${product.id})" data-translate="edit">${t('edit')}</button>
                    <button class="btn-small btn-success" onclick="adjustStock(${product.id})" data-translate="adjustStock">${t('adjustStock')}</button>
                    <button class="btn-small btn-danger" onclick="deleteProduct(${product.id})" data-translate="delete">${t('delete')}</button>
                </td>
            </tr>
        `;
    }).join('');
}

function filterInventory() {
    const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
    const categoryFilter = document.getElementById('category-filter').value;
    const stockFilter = document.getElementById('stock-filter').value;

    let filteredProducts = products.filter(product => {
        const name = (currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name).toLowerCase();
        const matchesSearch = name.includes(searchTerm) || product.barcode.includes(searchTerm);
        const matchesCategory = categoryFilter === 'all' || product.category === categoryFilter;

        let matchesStock = true;
        if (stockFilter === 'low') {
            matchesStock = product.stock <= product.minStock && product.stock > 0;
        } else if (stockFilter === 'out') {
            matchesStock = product.stock === 0;
        }

        return matchesSearch && matchesCategory && matchesStock;
    });

    document.getElementById('inventory-tbody').innerHTML = filteredProducts.map(product => {
        const productName = currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name;
        const isLowStock = product.stock <= product.minStock;
        const isOutOfStock = product.stock === 0;

        return `
            <tr class="${isOutOfStock ? 'out-of-stock' : isLowStock ? 'low-stock' : ''}">
                <td>${productName}</td>
                <td>${t(product.category)}</td>
                <td>${formatCurrency(product.price)}</td>
                <td>
                    <span class="stock-level ${isOutOfStock ? 'out' : isLowStock ? 'low' : 'normal'}">
                        ${product.stock}
                    </span>
                </td>
                <td>${product.minStock}</td>
                <td>${product.barcode}</td>
                <td>${product.supplier || t('notAvailable')}</td>
                <td class="actions">
                    <button class="btn-small btn-primary" onclick="editProduct(${product.id})" data-translate="edit">${t('edit')}</button>
                    <button class="btn-small btn-success" onclick="adjustStock(${product.id})" data-translate="adjustStock">${t('adjustStock')}</button>
                    <button class="btn-small btn-danger" onclick="deleteProduct(${product.id})" data-translate="delete">${t('delete')}</button>
                </td>
            </tr>
        `;
    }).join('');
}

function showAddProductModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>${t('addProduct')}</h2>
            <form onsubmit="addNewProduct(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('name')} (English):</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label>${t('name')} (Arabic):</label>
                        <input type="text" id="product-name-ar">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('category')}:</label>
                        <select id="product-category" required>
                            <option value="food">${t('food')}</option>
                            <option value="drinks">${t('drinks')}</option>
                            <option value="snacks">${t('snacks')}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>${t('price')}:</label>
                        <input type="number" id="product-price" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('stock')}:</label>
                        <input type="number" id="product-stock" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="minStock">${t('minStock')}:</label>
                        <input type="number" id="product-min-stock" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-translate="barcode">${t('barcode')}:</label>
                        <input type="text" id="product-barcode" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="supplier">${t('supplier')}:</label>
                        <input type="text" id="product-supplier">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function addNewProduct(event) {
    event.preventDefault();

    const newProduct = {
        id: Math.max(...products.map(p => p.id)) + 1,
        name: document.getElementById('product-name').value,
        nameAr: document.getElementById('product-name-ar').value,
        category: document.getElementById('product-category').value,
        price: parseFloat(document.getElementById('product-price').value),
        stock: parseInt(document.getElementById('product-stock').value),
        minStock: parseInt(document.getElementById('product-min-stock').value),
        maxStock: parseInt(document.getElementById('product-stock').value) * 5,
        barcode: document.getElementById('product-barcode').value,
        supplier: document.getElementById('product-supplier').value,
        cost: parseFloat(document.getElementById('product-price').value) * 0.6,
        active: true
    };

    products.push(newProduct);
    saveToStorage('products', products);

    closeModal();
    loadInventoryView();
    displayProducts(); // Refresh main products view

    alert(`Product "${newProduct.name}" added successfully!`);
}

function editProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>${t('editProduct')}</h2>
            <form onsubmit="updateProduct(event, ${productId})">
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('name')} (English):</label>
                        <input type="text" id="edit-product-name" value="${product.name}" required>
                    </div>
                    <div class="form-group">
                        <label>${t('name')} (Arabic):</label>
                        <input type="text" id="edit-product-name-ar" value="${product.nameAr || ''}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('category')}:</label>
                        <select id="edit-product-category" required>
                            <option value="food" ${product.category === 'food' ? 'selected' : ''}>${t('food')}</option>
                            <option value="drinks" ${product.category === 'drinks' ? 'selected' : ''}>${t('drinks')}</option>
                            <option value="snacks" ${product.category === 'snacks' ? 'selected' : ''}>${t('snacks')}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>${t('price')}:</label>
                        <input type="number" id="edit-product-price" step="0.01" value="${product.price}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>${t('stock')}:</label>
                        <input type="number" id="edit-product-stock" value="${product.stock}" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="minStock">${t('minStock')}:</label>
                        <input type="number" id="edit-product-min-stock" value="${product.minStock}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-translate="barcode">${t('barcode')}:</label>
                        <input type="text" id="edit-product-barcode" value="${product.barcode}" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="supplier">${t('supplier')}:</label>
                        <input type="text" id="edit-product-supplier" value="${product.supplier || ''}">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateProduct(event, productId) {
    event.preventDefault();

    const product = products.find(p => p.id === productId);
    if (!product) return;

    product.name = document.getElementById('edit-product-name').value;
    product.nameAr = document.getElementById('edit-product-name-ar').value;
    product.category = document.getElementById('edit-product-category').value;
    product.price = parseFloat(document.getElementById('edit-product-price').value);
    product.stock = parseInt(document.getElementById('edit-product-stock').value);
    product.minStock = parseInt(document.getElementById('edit-product-min-stock').value);
    product.barcode = document.getElementById('edit-product-barcode').value;
    product.supplier = document.getElementById('edit-product-supplier').value;

    saveToStorage('products', products);

    closeModal();
    loadInventoryView();
    displayProducts(); // Refresh main products view

    alert(`Product "${product.name}" updated successfully!`);
}

function adjustStock(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    const adjustment = prompt(`Current stock: ${product.stock}\nEnter adjustment (+/- number):`);
    if (adjustment === null) return;

    const adjustmentValue = parseInt(adjustment);
    if (isNaN(adjustmentValue)) {
        alert('Please enter a valid number');
        return;
    }

    const newStock = product.stock + adjustmentValue;
    if (newStock < 0) {
        alert('Stock cannot be negative');
        return;
    }

    product.stock = newStock;
    saveToStorage('products', products);

    loadInventoryView();
    displayProducts(); // Refresh main products view

    alert(`Stock adjusted for "${product.name}". New stock: ${product.stock}`);
}

function deleteProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    if (confirm(`Are you sure you want to delete "${product.name}"?`)) {
        const index = products.findIndex(p => p.id === productId);
        products.splice(index, 1);
        saveToStorage('products', products);

        loadInventoryView();
        displayProducts(); // Refresh main products view

        alert(`Product "${product.name}" deleted successfully!`);
    }
}

function closeModal() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => modal.remove());
}

// ===== REPORTS MANAGEMENT =====

function loadReportsView() {
    const reportsView = document.getElementById('reports-view');
    reportsView.innerHTML = `
        <div class="reports-header">
            <h2 data-translate="reports">${t('reports')}</h2>
            <div class="reports-actions">
                <button class="btn btn-primary" onclick="generateDailyReport()" data-translate="dailyReport">${t('dailyReport')}</button>
                <button class="btn btn-secondary" onclick="generateWeeklyReport()" data-translate="weeklyReport">${t('weeklyReport')}</button>
                <button class="btn btn-info" onclick="toggleCharts()" data-translate="charts">${t('charts')}</button>
                <button class="btn btn-success" onclick="exportReports()" data-translate="export">${t('export')}</button>
            </div>
        </div>

        <div class="reports-dashboard">
            <div class="report-cards">
                <div class="report-card">
                    <h3 data-translate="todaysSales">${t('todaysSales')}</h3>
                    <div class="report-value">${formatCurrency(getTodaysSales())}</div>
                    <div class="report-subtitle">${getTodaysTransactions()} ${t('transactions')}</div>
                </div>
                <div class="report-card">
                    <h3 data-translate="thisWeek">${t('thisWeek')}</h3>
                    <div class="report-value">${formatCurrency(getWeekSales())}</div>
                    <div class="report-subtitle">${getWeekTransactions()} ${t('transactions')}</div>
                </div>
                <div class="report-card">
                    <h3 data-translate="lowStock">${t('lowStock')} ${t('products')}</h3>
                    <div class="report-value">${getLowStockCount()}</div>
                    <div class="report-subtitle">${t('itemsNeedRestocking')}</div>
                </div>
                <div class="report-card">
                    <h3 data-translate="totalProducts">${t('totalProducts')}</h3>
                    <div class="report-value">${products.length}</div>
                    <div class="report-subtitle">${t('activeProducts')}</div>
                </div>
            </div>

            <div class="charts-section" id="charts-section" style="display: none;">
                <div class="charts-container">
                    <div class="chart-card">
                        <h3 data-translate="salesChart">${t('salesChart')}</h3>
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 data-translate="productChart">${t('productChart')}</h3>
                        <canvas id="productChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="reports-content">
                <div class="report-section">
                    <h3 data-translate="recentSales">${t('recentSales')}</h3>
                    <div class="sales-table">
                        <table>
                            <thead>
                                <tr>
                                    <th data-translate="date">${t('date')}</th>
                                    <th data-translate="receipt">${t('receipt')} #</th>
                                    <th data-translate="cashier">${t('cashier')}</th>
                                    <th data-translate="products">${t('products')}</th>
                                    <th data-translate="total">${t('total')}</th>
                                    <th data-translate="paymentMethod">${t('paymentMethod')}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generateRecentSalesRows()}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="report-section">
                    <h3 data-translate="topSellingProducts">${t('topSellingProducts')}</h3>
                    <div class="top-products">
                        ${generateTopProductsReport()}
                    </div>
                </div>

                <div class="report-section">
                    <h3 data-translate="cashierPerformance">${t('cashierPerformance')}</h3>
                    <div class="cashier-performance">
                        ${generateCashierPerformance()}
                    </div>
                </div>
            </div>
        </div>
    `;
}

function getTodaysSales() {
    const today = new Date().toDateString();
    return salesHistory
        .filter(sale => new Date(sale.date).toDateString() === today)
        .reduce((sum, sale) => sum + sale.total, 0);
}

function getTodaysTransactions() {
    const today = new Date().toDateString();
    return salesHistory.filter(sale => new Date(sale.date).toDateString() === today).length;
}

function getWeekSales() {
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    return salesHistory
        .filter(sale => new Date(sale.date) >= weekAgo)
        .reduce((sum, sale) => sum + sale.total, 0);
}

function getWeekTransactions() {
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    return salesHistory.filter(sale => new Date(sale.date) >= weekAgo).length;
}

function getLowStockCount() {
    return products.filter(product => product.stock <= product.minStock).length;
}

function generateRecentSalesRows() {
    const recentSales = salesHistory.slice(-10).reverse();
    return recentSales.map(sale => {
        const date = new Date(sale.date);
        return `
            <tr>
                <td>${date.toLocaleDateString()}</td>
                <td>${sale.id}</td>
                <td>${sale.cashier}</td>
                <td>${sale.items.length}</td>
                <td>${formatCurrency(sale.total)}</td>
                <td>${sale.paymentMethod}</td>
            </tr>
        `;
    }).join('');
}

function generateTopProductsReport() {
    const productSales = {};

    salesHistory.forEach(sale => {
        sale.items.forEach(item => {
            if (!productSales[item.id]) {
                productSales[item.id] = {
                    name: item.name,
                    quantity: 0,
                    revenue: 0
                };
            }
            productSales[item.id].quantity += item.quantity;
            productSales[item.id].revenue += item.price * item.quantity;
        });
    });

    const sortedProducts = Object.values(productSales)
        .sort((a, b) => b.quantity - a.quantity)
        .slice(0, 5);

    return sortedProducts.map((product, index) => `
        <div class="top-product-item">
            <span class="rank">#${index + 1}</span>
            <span class="product-name">${product.name}</span>
            <span class="quantity">${product.quantity} sold</span>
            <span class="revenue">${formatCurrency(product.revenue)}</span>
        </div>
    `).join('');
}

function generateCashierPerformance() {
    const cashierStats = {};

    salesHistory.forEach(sale => {
        if (!cashierStats[sale.cashier]) {
            cashierStats[sale.cashier] = {
                transactions: 0,
                revenue: 0
            };
        }
        cashierStats[sale.cashier].transactions++;
        cashierStats[sale.cashier].revenue += sale.total;
    });

    return Object.entries(cashierStats).map(([cashier, stats]) => `
        <div class="cashier-stat">
            <span class="cashier-name">${cashier}</span>
            <span class="transactions">${stats.transactions} transactions</span>
            <span class="revenue">${formatCurrency(stats.revenue)}</span>
        </div>
    `).join('');
}

function generateDailyReport() {
    const today = new Date().toDateString();
    const todaySales = salesHistory.filter(sale => new Date(sale.date).toDateString() === today);

    const reportWindow = window.open('', '_blank');
    const reportHTML = `
        <!DOCTYPE html>
        <html>
        <head>
            <title>${t('dailyReport')} - ${today}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { text-align: center; margin-bottom: 30px; }
                .summary { background: #f5f5f5; padding: 20px; margin-bottom: 20px; }
                table { width: 100%; border-collapse: collapse; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background: #667eea; color: white; }
                .total { font-weight: bold; background: #f0f0f0; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>${settings.companyName}</h1>
                <h2>${t('dailyReport')}</h2>
                <p>${t('date')}: ${today}</p>
            </div>

            <div class="summary">
                <h3>${t('summary')}</h3>
                <p>Total Sales: ${formatCurrency(todaySales.reduce((sum, sale) => sum + sale.total, 0))}</p>
                <p>Total Transactions: ${todaySales.length}</p>
                <p>Average Transaction: ${formatCurrency(todaySales.reduce((sum, sale) => sum + sale.total, 0) / todaySales.length || 0)}</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Receipt #</th>
                        <th>Cashier</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Payment Method</th>
                    </tr>
                </thead>
                <tbody>
                    ${todaySales.map(sale => `
                        <tr>
                            <td>${new Date(sale.date).toLocaleTimeString()}</td>
                            <td>${sale.id}</td>
                            <td>${sale.cashier}</td>
                            <td>${sale.items.length}</td>
                            <td>${formatCurrency(sale.total)}</td>
                            <td>${sale.paymentMethod}</td>
                        </tr>
                    `).join('')}
                    <tr class="total">
                        <td colspan="4"><strong>TOTAL</strong></td>
                        <td><strong>${formatCurrency(todaySales.reduce((sum, sale) => sum + sale.total, 0))}</strong></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </body>
        </html>
    `;

    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
    reportWindow.focus();
    reportWindow.print();
}

function generateWeeklyReport() {
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    const weeklySales = salesHistory.filter(sale => new Date(sale.date) >= weekAgo);

    const reportWindow = window.open('', '_blank');
    const reportHTML = `
        <!DOCTYPE html>
        <html dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}" lang="${currentLanguage}">
        <head>
            <title>${t('weeklyReport')} - ${settings.companyName}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { text-align: center; margin-bottom: 30px; }
                .summary { background: #f5f5f5; padding: 20px; margin-bottom: 20px; }
                table { width: 100%; border-collapse: collapse; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background: #667eea; color: white; }
                .total { font-weight: bold; background: #f0f0f0; }
                [dir="rtl"] th, [dir="rtl"] td { text-align: right; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>${settings.companyName}</h1>
                <h2>${t('weeklyReport')}</h2>
                <p>${t('date')}: ${weekAgo.toLocaleDateString()} - ${new Date().toLocaleDateString()}</p>
            </div>

            <div class="summary">
                <h3>${t('summary')}</h3>
                <p><strong>${t('totalSales')}:</strong> ${formatCurrency(weeklySales.reduce((sum, sale) => sum + sale.total, 0))}</p>
                <p><strong>${t('totalTransactions')}:</strong> ${weeklySales.length}</p>
                <p><strong>${t('averageTransaction')}:</strong> ${formatCurrency(weeklySales.reduce((sum, sale) => sum + sale.total, 0) / weeklySales.length || 0)}</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>${t('date')}</th>
                        <th>${t('receipt')} #</th>
                        <th>${t('cashier')}</th>
                        <th>${t('products')}</th>
                        <th>${t('total')}</th>
                        <th>${t('paymentMethod')}</th>
                    </tr>
                </thead>
                <tbody>
                    ${weeklySales.map(sale => `
                        <tr>
                            <td>${new Date(sale.date).toLocaleDateString()}</td>
                            <td>${sale.id}</td>
                            <td>${sale.cashier}</td>
                            <td>${sale.items.length}</td>
                            <td>${formatCurrency(sale.total)}</td>
                            <td>${sale.paymentMethod}</td>
                        </tr>
                    `).join('')}
                    <tr class="total">
                        <td colspan="4"><strong>${t('total').toUpperCase()}</strong></td>
                        <td><strong>${formatCurrency(weeklySales.reduce((sum, sale) => sum + sale.total, 0))}</strong></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </body>
        </html>
    `;

    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
    reportWindow.focus();
    reportWindow.print();
}

// ===== INVOICE SYSTEM =====

function printInvoice(sale = null) {
    if (!sale && cart.length === 0) {
        alert(t('emptyCart'));
        return;
    }

    let invoiceData;
    if (sale) {
        invoiceData = sale;
    } else {
        // Create temporary invoice data for current cart
        const subtotal = cart.reduce((sum, item) => sum + (convertPrice(item.price) * item.quantity), 0);
        const tax = subtotal * settings.taxRate;
        const total = subtotal + tax;

        invoiceData = {
            id: 'INV-' + Date.now(),
            date: new Date().toISOString(),
            cashier: currentUser.name,
            items: [...cart],
            subtotal: subtotal / currencies[currentCurrency].rate,
            tax: tax / currencies[currentCurrency].rate,
            total: total / currencies[currentCurrency].rate,
            paymentMethod: 'N/A',
            currency: currentCurrency
        };
    }

    const invoiceWindow = window.open('', '_blank');
    const invoiceHTML = generateInvoiceHTML(invoiceData);

    invoiceWindow.document.write(invoiceHTML);
    invoiceWindow.document.close();
    invoiceWindow.focus();
    invoiceWindow.print();
}

function generateInvoiceHTML(sale) {
    const date = new Date(sale.date);
    const formattedDate = date.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US');
    const formattedTime = date.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US');

    return `
        <!DOCTYPE html>
        <html dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}" lang="${currentLanguage}">
        <head>
            <meta charset="UTF-8">
            <title>${t('businessInvoice')} - ${sale.id}</title>
            <style>
                body {
                    font-family: 'Arial', sans-serif;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                    font-size: 14px;
                    line-height: 1.6;
                    color: #333;
                }
                .invoice-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    margin-bottom: 40px;
                    border-bottom: 3px solid #667eea;
                    padding-bottom: 20px;
                }
                .company-info h1 {
                    color: #667eea;
                    margin: 0 0 10px 0;
                    font-size: 28px;
                }
                .invoice-details {
                    text-align: right;
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 8px;
                }
                .invoice-title {
                    font-size: 24px;
                    color: #667eea;
                    font-weight: bold;
                    margin-bottom: 10px;
                }
                .customer-section {
                    margin: 30px 0;
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                }
                .items-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 30px 0;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }
                .items-table th, .items-table td {
                    border: 1px solid #ddd;
                    padding: 12px;
                    text-align: left;
                }
                .items-table th {
                    background: #667eea;
                    color: white;
                    font-weight: bold;
                }
                .items-table tr:nth-child(even) {
                    background: #f8f9fa;
                }
                .totals-section {
                    margin-top: 30px;
                    display: flex;
                    justify-content: flex-end;
                }
                .totals-table {
                    width: 300px;
                    border-collapse: collapse;
                }
                .totals-table td {
                    padding: 8px 15px;
                    border: 1px solid #ddd;
                }
                .total-row {
                    font-weight: bold;
                    background: #667eea;
                    color: white;
                    font-size: 16px;
                }
                .footer {
                    text-align: center;
                    margin-top: 40px;
                    padding-top: 20px;
                    border-top: 1px solid #ddd;
                    color: #666;
                }
                [dir="rtl"] .invoice-details {
                    text-align: left;
                }
                [dir="rtl"] .items-table th, [dir="rtl"] .items-table td {
                    text-align: right;
                }
                @media print {
                    body { margin: 0; padding: 10px; }
                }
            </style>
        </head>
        <body>
            <div class="invoice-header">
                <div class="company-info">
                    <h1>${settings.companyName}</h1>
                    <div>${settings.companyAddress}</div>
                    <div>${settings.companyPhone}</div>
                </div>
                <div class="invoice-details">
                    <div class="invoice-title">${t('businessInvoice')}</div>
                    <div><strong>${t('invoice')} #:</strong> ${sale.id}</div>
                    <div><strong>${t('date')}:</strong> ${formattedDate}</div>
                    <div><strong>${t('time')}:</strong> ${formattedTime}</div>
                    <div><strong>${t('cashier')}:</strong> ${sale.cashier}</div>
                </div>
            </div>

            <div class="customer-section">
                <h3>${t('customerInfo')}</h3>
                <div><strong>${t('currency')}:</strong> ${getCurrencyName(sale.currency)}</div>
                <div><strong>${t('paymentMethod')}:</strong> ${sale.paymentMethod}</div>
            </div>

            <table class="items-table">
                <thead>
                    <tr>
                        <th>${t('description')}</th>
                        <th>${t('quantity')}</th>
                        <th>${t('price')}</th>
                        <th>${t('total')}</th>
                    </tr>
                </thead>
                <tbody>
                    ${sale.items.map(item => {
                        const itemName = getProductName(item);
                        const itemTotal = item.price * item.quantity;
                        return `
                            <tr>
                                <td>${itemName}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.price)}</td>
                                <td>${formatCurrency(itemTotal)}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>

            <div class="totals-section">
                <table class="totals-table">
                    <tr>
                        <td>${t('subtotal')}:</td>
                        <td>${formatCurrency(sale.subtotal)}</td>
                    </tr>
                    <tr>
                        <td>${t('tax')} (${(settings.taxRate * 100).toFixed(0)}%):</td>
                        <td>${formatCurrency(sale.tax)}</td>
                    </tr>
                    <tr class="total-row">
                        <td>${t('total')}:</td>
                        <td>${formatCurrency(sale.total)}</td>
                    </tr>
                </table>
            </div>

            <div class="footer">
                <div>${settings.receiptFooter}</div>
                <div style="margin-top: 10px; font-size: 12px;">
                    ${t('businessInvoice')} - ${settings.companyName}
                </div>
            </div>
        </body>
        </html>
    `;
}

// ===== LOW STOCK & EXPIRED ITEMS PRINTING =====

function printLowStockReport() {
    const lowStockProducts = products.filter(product =>
        product.active && product.stock <= product.minStock
    );

    if (lowStockProducts.length === 0) {
        alert(t('noLowStockItems'));
        return;
    }

    const reportWindow = window.open('', '_blank');
    const reportHTML = generateLowStockReportHTML(lowStockProducts);

    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
    reportWindow.focus();
    reportWindow.print();
}

function printExpiredItemsReport() {
    const expiredProducts = products.filter(product =>
        product.active && product.expiryDate && new Date(product.expiryDate) < new Date()
    );

    const nearExpiryProducts = products.filter(product =>
        product.active && product.expiryDate &&
        new Date(product.expiryDate) <= new Date(Date.now() + 3 * 24 * 60 * 60 * 1000) &&
        new Date(product.expiryDate) >= new Date()
    );

    if (expiredProducts.length === 0 && nearExpiryProducts.length === 0) {
        alert(t('noExpiredItems'));
        return;
    }

    const reportWindow = window.open('', '_blank');
    const reportHTML = generateExpiredItemsReportHTML(expiredProducts, nearExpiryProducts);

    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
    reportWindow.focus();
    reportWindow.print();
}

function generateLowStockReportHTML(lowStockProducts) {
    const currentDate = new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US');

    return `
        <!DOCTYPE html>
        <html dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}" lang="${currentLanguage}">
        <head>
            <meta charset="UTF-8">
            <title>${t('lowStockReport')} - ${currentDate}</title>
            <style>
                body {
                    font-family: 'Arial', sans-serif;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                    font-size: 14px;
                    line-height: 1.6;
                }
                .header {
                    text-align: center;
                    margin-bottom: 30px;
                    border-bottom: 2px solid #dc3545;
                    padding-bottom: 20px;
                }
                .header h1 {
                    color: #dc3545;
                    margin-bottom: 10px;
                }
                .summary {
                    background: #f8d7da;
                    padding: 20px;
                    margin-bottom: 20px;
                    border-radius: 8px;
                    border-left: 4px solid #dc3545;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-bottom: 20px;
                }
                th, td {
                    border: 1px solid #ddd;
                    padding: 12px;
                    text-align: left;
                }
                th {
                    background: #dc3545;
                    color: white;
                    font-weight: bold;
                }
                tr:nth-child(even) {
                    background: #f8f9fa;
                }
                .urgent {
                    background: #f8d7da !important;
                    font-weight: bold;
                }
                .footer {
                    text-align: center;
                    margin-top: 30px;
                    color: #666;
                }
                [dir="rtl"] th, [dir="rtl"] td {
                    text-align: right;
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>${settings.companyName}</h1>
                <h2>${t('lowStockReport')}</h2>
                <p>${t('date')}: ${currentDate}</p>
            </div>

            <div class="summary">
                <h3>${t('summary')}</h3>
                <p><strong>${t('totalProducts')}:</strong> ${lowStockProducts.length} ${t('itemsNeedRestocking')}</p>
                <p><strong>${t('urgentAction')}:</strong> ${t('restockImmediately')}</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>${t('productName')}</th>
                        <th>${t('category')}</th>
                        <th>${t('currentStock')}</th>
                        <th>${t('minimumStock')}</th>
                        <th>${t('supplier')}</th>
                        <th>${t('status')}</th>
                    </tr>
                </thead>
                <tbody>
                    ${lowStockProducts.map(product => {
                        const productName = getProductName(product);
                        const isUrgent = product.stock === 0;
                        return `
                            <tr class="${isUrgent ? 'urgent' : ''}">
                                <td>${productName}</td>
                                <td>${t(product.category)}</td>
                                <td>${product.stock}</td>
                                <td>${product.minStock}</td>
                                <td>${product.supplier || t('notAvailable')}</td>
                                <td>${isUrgent ? t('outOfStock') : t('lowStock')}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>

            <div class="footer">
                <p>${t('generatedBy')}: ${settings.companyName} POS System</p>
                <p>${t('printedOn')}: ${new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US')}</p>
            </div>
        </body>
        </html>
    `;
}

function generateExpiredItemsReportHTML(expiredProducts, nearExpiryProducts) {
    const currentDate = new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US');

    return `
        <!DOCTYPE html>
        <html dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}" lang="${currentLanguage}">
        <head>
            <meta charset="UTF-8">
            <title>${t('expiredItems')} ${t('report')} - ${currentDate}</title>
            <style>
                body {
                    font-family: 'Arial', sans-serif;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                    font-size: 14px;
                    line-height: 1.6;
                }
                .header {
                    text-align: center;
                    margin-bottom: 30px;
                    border-bottom: 2px solid #dc3545;
                    padding-bottom: 20px;
                }
                .header h1 {
                    color: #dc3545;
                    margin-bottom: 10px;
                }
                .summary {
                    background: #f8d7da;
                    padding: 20px;
                    margin-bottom: 20px;
                    border-radius: 8px;
                    border-left: 4px solid #dc3545;
                }
                .section {
                    margin-bottom: 30px;
                }
                .section h3 {
                    color: #dc3545;
                    border-bottom: 1px solid #ddd;
                    padding-bottom: 10px;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-bottom: 20px;
                }
                th, td {
                    border: 1px solid #ddd;
                    padding: 12px;
                    text-align: left;
                }
                th {
                    background: #dc3545;
                    color: white;
                    font-weight: bold;
                }
                tr:nth-child(even) {
                    background: #f8f9fa;
                }
                .expired-row {
                    background: #f8d7da !important;
                    font-weight: bold;
                }
                .near-expiry-row {
                    background: #fff3cd !important;
                }
                .footer {
                    text-align: center;
                    margin-top: 30px;
                    color: #666;
                }
                [dir="rtl"] th, [dir="rtl"] td {
                    text-align: right;
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>${settings.companyName}</h1>
                <h2>${t('expiredItems')} ${t('report')}</h2>
                <p>${t('date')}: ${currentDate}</p>
            </div>

            <div class="summary">
                <h3>${t('summary')}</h3>
                <p><strong>${t('expired')}:</strong> ${expiredProducts.length} ${t('products')}</p>
                <p><strong>${t('nearExpiry')}:</strong> ${nearExpiryProducts.length} ${t('products')}</p>
                <p><strong>${t('urgentAction')}:</strong> Remove expired items immediately</p>
            </div>

            ${expiredProducts.length > 0 ? `
            <div class="section">
                <h3>${t('expired')} ${t('products')}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>${t('productName')}</th>
                            <th>${t('category')}</th>
                            <th>${t('expiryDate')}</th>
                            <th>${t('daysOverdue')}</th>
                            <th>${t('currentStock')}</th>
                            <th>${t('supplier')}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${expiredProducts.map(product => {
                            const productName = getProductName(product);
                            const expiryDate = new Date(product.expiryDate);
                            const daysOverdue = Math.floor((new Date() - expiryDate) / (1000 * 60 * 60 * 24));
                            return `
                                <tr class="expired-row">
                                    <td>${productName}</td>
                                    <td>${t(product.category)}</td>
                                    <td>${expiryDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US')}</td>
                                    <td>${daysOverdue}</td>
                                    <td>${product.stock}</td>
                                    <td>${product.supplier || t('notAvailable')}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}

            ${nearExpiryProducts.length > 0 ? `
            <div class="section">
                <h3>${t('nearExpiry')} ${t('products')}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>${t('productName')}</th>
                            <th>${t('category')}</th>
                            <th>${t('expiryDate')}</th>
                            <th>${t('daysUntilExpiry')}</th>
                            <th>${t('currentStock')}</th>
                            <th>${t('supplier')}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${nearExpiryProducts.map(product => {
                            const productName = getProductName(product);
                            const expiryDate = new Date(product.expiryDate);
                            const daysUntilExpiry = Math.floor((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
                            return `
                                <tr class="near-expiry-row">
                                    <td>${productName}</td>
                                    <td>${t(product.category)}</td>
                                    <td>${expiryDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US')}</td>
                                    <td>${daysUntilExpiry}</td>
                                    <td>${product.stock}</td>
                                    <td>${product.supplier || t('notAvailable')}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}

            <div class="footer">
                <p>${t('generatedBy')}: ${settings.companyName} POS System</p>
                <p>${t('printedOn')}: ${new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US')}</p>
            </div>
        </body>
        </html>
    `;
}

// ===== USERS MANAGEMENT =====

function loadUsersView() {
    if (!hasPermission('users')) {
        document.getElementById('users-view').innerHTML = `
            <div class="access-denied">
                <h2>Access Denied</h2>
                <p>You don't have permission to manage users.</p>
            </div>
        `;
        return;
    }

    const usersView = document.getElementById('users-view');
    usersView.innerHTML = `
        <div class="users-header">
            <h2 data-translate="users">${t('users')}</h2>
            <div class="users-actions">
                <button class="btn btn-primary" onclick="showAddUserModal()" data-translate="addUser">${t('addUser')}</button>
                <button class="btn btn-secondary" onclick="exportUsers()" data-translate="exportUsers">${t('exportUsers')}</button>
            </div>
        </div>

        <div class="users-table">
            <table>
                <thead>
                    <tr>
                        <th data-translate="id">${t('id')}</th>
                        <th data-translate="username">${t('username')}</th>
                        <th data-translate="name">${t('name')}</th>
                        <th data-translate="role">${t('role')}</th>
                        <th data-translate="cardNumber">${t('cardNumber')}</th>
                        <th data-translate="cardAccess">${t('cardAccess')}</th>
                        <th data-translate="status">${t('status')}</th>
                        <th data-translate="actions">${t('actions')}</th>
                    </tr>
                </thead>
                <tbody>
                    ${generateUsersRows()}
                </tbody>
            </table>
        </div>
    `;
}

function generateUsersRows() {
    return users.map(user => `
        <tr class="${user.active ? '' : 'inactive'}">
            <td>${user.id}</td>
            <td>${user.username}</td>
            <td>${user.name}</td>
            <td>
                <span class="role-badge role-${user.role}">${t(user.role)}</span>
            </td>
            <td>${user.cardNumber || t('notAvailable')}</td>
            <td>
                <span class="status-badge ${user.cardAccess ? 'active' : 'inactive'}">
                    ${user.cardAccess ? t('active') : t('inactive')}
                </span>
            </td>
            <td>
                <span class="status-badge ${user.active ? 'active' : 'inactive'}">
                    ${user.active ? t('active') : t('inactive')}
                </span>
            </td>
            <td class="actions">
                <button class="btn-small btn-primary" onclick="editUser(${user.id})">${t('edit')}</button>
                <button class="btn-small ${user.active ? 'btn-warning' : 'btn-success'}"
                        onclick="toggleUserStatus(${user.id})">
                    ${user.active ? 'Deactivate' : 'Activate'}
                </button>
                ${user.id !== currentUser.id ? `<button class="btn-small btn-danger" onclick="deleteUser(${user.id})">${t('delete')}</button>` : ''}
            </td>
        </tr>
    `).join('');
}

function showAddUserModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>Add New User</h2>
            <form onsubmit="addNewUser(event)">
                <div class="form-group">
                    <label data-translate="username">${t('username')}:</label>
                    <input type="text" id="user-username" required>
                </div>
                <div class="form-group">
                    <label data-translate="fullName">${t('fullName')}:</label>
                    <input type="text" id="user-name" required>
                </div>
                <div class="form-group">
                    <label data-translate="password">${t('password')}:</label>
                    <input type="password" id="user-password" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="user-role" required>
                        <option value="cashier">${t('cashier')}</option>
                        <option value="manager">${t('manager')}</option>
                        ${currentUser.role === 'admin' ? `<option value="admin">${t('admin')}</option>` : ''}
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function addNewUser(event) {
    event.preventDefault();

    const username = document.getElementById('user-username').value;

    // Check if username already exists
    if (users.find(u => u.username === username)) {
        alert('Username already exists!');
        return;
    }

    const newUser = {
        id: Math.max(...users.map(u => u.id)) + 1,
        username: username,
        name: document.getElementById('user-name').value,
        password: document.getElementById('user-password').value,
        role: document.getElementById('user-role').value,
        active: true
    };

    users.push(newUser);
    saveToStorage('users', users);

    closeModal();
    loadUsersView();

    alert(`User "${newUser.name}" added successfully!`);
}

function editUser(userId) {
    const user = users.find(u => u.id === userId);
    if (!user) return;

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>Edit User</h2>
            <form onsubmit="updateUser(event, ${userId})">
                <div class="form-group">
                    <label data-translate="username">${t('username')}:</label>
                    <input type="text" id="edit-user-username" value="${user.username}" required>
                </div>
                <div class="form-group">
                    <label data-translate="fullName">${t('fullName')}:</label>
                    <input type="text" id="edit-user-name" value="${user.name}" required>
                </div>
                <div class="form-group">
                    <label data-translate="newPassword">${t('newPassword')}:</label>
                    <input type="password" id="edit-user-password">
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="edit-user-role" required>
                        <option value="cashier" ${user.role === 'cashier' ? 'selected' : ''}>${t('cashier')}</option>
                        <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>${t('manager')}</option>
                        ${currentUser.role === 'admin' ? `<option value="admin" ${user.role === 'admin' ? 'selected' : ''}>${t('admin')}</option>` : ''}
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateUser(event, userId) {
    event.preventDefault();

    const user = users.find(u => u.id === userId);
    if (!user) return;

    const newUsername = document.getElementById('edit-user-username').value;

    // Check if username already exists (excluding current user)
    if (users.find(u => u.username === newUsername && u.id !== userId)) {
        alert('Username already exists!');
        return;
    }

    user.username = newUsername;
    user.name = document.getElementById('edit-user-name').value;
    user.role = document.getElementById('edit-user-role').value;

    const newPassword = document.getElementById('edit-user-password').value;
    if (newPassword) {
        user.password = newPassword;
    }

    saveToStorage('users', users);

    closeModal();
    loadUsersView();

    alert(`User "${user.name}" updated successfully!`);
}

function toggleUserStatus(userId) {
    const user = users.find(u => u.id === userId);
    if (!user) return;

    if (user.id === currentUser.id) {
        alert("You cannot deactivate your own account!");
        return;
    }

    user.active = !user.active;
    saveToStorage('users', users);

    loadUsersView();

    alert(`User "${user.name}" ${user.active ? 'activated' : 'deactivated'} successfully!`);
}

function deleteUser(userId) {
    const user = users.find(u => u.id === userId);
    if (!user) return;

    if (user.id === currentUser.id) {
        alert("You cannot delete your own account!");
        return;
    }

    if (confirm(`Are you sure you want to delete user "${user.name}"?`)) {
        const index = users.findIndex(u => u.id === userId);
        users.splice(index, 1);
        saveToStorage('users', users);

        loadUsersView();

        alert(`User "${user.name}" deleted successfully!`);
    }
}

// ===== SETTINGS MANAGEMENT =====

function loadSettingsView() {
    if (!hasPermission('settings')) {
        document.getElementById('settings-view').innerHTML = `
            <div class="access-denied">
                <h2>Access Denied</h2>
                <p>You don't have permission to access settings.</p>
            </div>
        `;
        return;
    }

    const settingsView = document.getElementById('settings-view');
    settingsView.innerHTML = `
        <div class="settings-header">
            <h2 data-translate="settings">${t('settings')}</h2>
            <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveSettings()" data-translate="saveSettings">${t('saveSettings')}</button>
                <button class="btn btn-secondary" onclick="resetSettings()" data-translate="resetSettings">${t('resetSettings')}</button>
                <button class="btn btn-warning" onclick="exportData()" data-translate="exportData">${t('exportData')}</button>
                <button class="btn btn-success" onclick="importData()" data-translate="importData">${t('importData')}</button>
            </div>
        </div>

        <div class="settings-content">
            <div class="settings-section">
                <h3 data-translate="companySettings">${t('companySettings')}</h3>
                <div class="form-group">
                    <label data-translate="name">${t('name')}:</label>
                    <input type="text" id="setting-company-name" value="${settings.companyName}">
                </div>
                <div class="form-group">
                    <label data-translate="address">${t('address')}:</label>
                    <input type="text" id="setting-company-address" value="${settings.companyAddress}">
                </div>
                <div class="form-group">
                    <label data-translate="phone">${t('phone')}:</label>
                    <input type="text" id="setting-company-phone" value="${settings.companyPhone}">
                </div>
                <div class="form-group">
                    <label data-translate="receiptFooter">${t('receiptFooter')}:</label>
                    <textarea id="setting-receipt-footer">${settings.receiptFooter}</textarea>
                </div>
            </div>

            <div class="settings-section">
                <h3 data-translate="logoSettings">${t('logoSettings')}</h3>
                <div class="logo-upload-section">
                    <div class="current-logo">
                        ${settings.companyLogo ? `
                            <img src="${settings.companyLogo}" alt="Company Logo" id="current-logo-preview" style="max-width: 200px; max-height: 100px; border: 1px solid #ddd; border-radius: 8px;">
                            <button type="button" class="btn btn-danger btn-small" onclick="removeLogo()" data-translate="removeLogo">${t('removeLogo')}</button>
                        ` : `
                            <div class="no-logo" style="width: 200px; height: 100px; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; color: #666; border-radius: 8px;">
                                ${t('companyLogo')}
                            </div>
                        `}
                    </div>
                    <div class="logo-upload-controls">
                        <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('logo-upload').click()" data-translate="uploadLogo">${t('uploadLogo')}</button>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            ${t('recommendedSize')}: 200x100px, PNG/JPG
                        </p>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>System Settings</h3>
                <div class="form-group">
                    <label>Tax Rate (%):</label>
                    <input type="number" id="setting-tax-rate" step="0.01" value="${(settings.taxRate * 100).toFixed(2)}">
                </div>
                <div class="form-group">
                    <label>Low Stock Threshold:</label>
                    <input type="number" id="setting-low-stock-threshold" value="${settings.lowStockThreshold}">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="setting-auto-backup" ${settings.autoBackup ? 'checked' : ''}>
                        Enable Auto Backup
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="setting-print-after-sale" ${settings.printAfterSale ? 'checked' : ''}>
                        Auto Print Receipt After Sale
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="setting-show-barcode" ${settings.showBarcode ? 'checked' : ''}>
                        Show Barcodes on Products
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>Default Language & Currency</h3>
                <div class="form-group">
                    <label>Default Language:</label>
                    <select id="setting-default-language">
                        <option value="en" ${currentLanguage === 'en' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ English</option>
                        <option value="ar" ${currentLanguage === 'ar' ? 'selected' : ''}>ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="fr" ${currentLanguage === 'fr' ? 'selected' : ''}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="es" ${currentLanguage === 'es' ? 'selected' : ''}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Default Currency:</label>
                    <select id="setting-default-currency">
                        ${Object.entries(currencies).map(([code, curr]) =>
                            `<option value="${code}" ${currentCurrency === code ? 'selected' : ''}>${curr.symbol} ${curr.name}</option>`
                        ).join('')}
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Data Management</h3>
                <div class="data-stats">
                    <p><strong>Products:</strong> ${products.length} items</p>
                    <p><strong>Sales History:</strong> ${salesHistory.length} transactions</p>
                    <p><strong>Users:</strong> ${users.length} accounts</p>
                    <p><strong>Last Backup:</strong> ${localStorage.getItem('lastBackup') || 'Never'}</p>
                </div>
                <div class="data-actions">
                    <button class="btn btn-info" onclick="createBackup()" data-translate="createBackup">${t('createBackup')}</button>
                    <button class="btn btn-warning" onclick="clearAllData()" data-translate="clearAllData">${t('clearAllData')}</button>
                </div>
            </div>
        </div>
    `;
}

function saveSettings() {
    settings.companyName = document.getElementById('setting-company-name').value;
    settings.companyAddress = document.getElementById('setting-company-address').value;
    settings.companyPhone = document.getElementById('setting-company-phone').value;
    settings.receiptFooter = document.getElementById('setting-receipt-footer').value;
    settings.taxRate = parseFloat(document.getElementById('setting-tax-rate').value) / 100;
    settings.lowStockThreshold = parseInt(document.getElementById('setting-low-stock-threshold').value);
    settings.autoBackup = document.getElementById('setting-auto-backup').checked;
    settings.printAfterSale = document.getElementById('setting-print-after-sale').checked;
    settings.showBarcode = document.getElementById('setting-show-barcode').checked;

    // Save to localStorage
    Object.keys(settings).forEach(key => {
        localStorage.setItem(key, settings[key]);
    });

    // Update language and currency if changed
    const newLanguage = document.getElementById('setting-default-language').value;
    const newCurrency = document.getElementById('setting-default-currency').value;

    if (newLanguage !== currentLanguage) {
        changeLanguage(newLanguage);
    }

    if (newCurrency !== currentCurrency) {
        changeCurrency(newCurrency);
    }

    alert('Settings saved successfully!');

    // Refresh displays
    displayProducts();
    updateCartDisplay();
}

function createBackup() {
    const backupData = {
        products: products,
        salesHistory: salesHistory,
        users: users,
        settings: settings,
        timestamp: new Date().toISOString()
    };

    const dataStr = JSON.stringify(backupData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});

    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `pos-backup-${new Date().toISOString().split('T')[0]}.json`;
    link.click();

    localStorage.setItem('lastBackup', new Date().toLocaleString());

    alert('Backup created successfully!');
}

// ===== MISSING BUTTON FUNCTIONS =====

function exportInventory() {
    const inventoryData = products.map(product => ({
        id: product.id,
        name: getProductName(product),
        category: t(product.category),
        price: formatCurrency(product.price),
        stock: product.stock,
        minStock: product.minStock,
        barcode: product.barcode,
        supplier: product.supplier || t('notAvailable'),
        expiryDate: product.expiryDate || t('notAvailable')
    }));

    const csvContent = "data:text/csv;charset=utf-8,"
        + [
            [t('name'), t('category'), t('price'), t('stock'), t('minStock'), t('barcode'), t('supplier'), t('expiryDate')].join(','),
            ...inventoryData.map(row => Object.values(row).join(','))
        ].join('\n');

    const link = document.createElement('a');
    link.href = encodeURI(csvContent);
    link.download = `inventory-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();

    alert(t('inventoryExported'));
}

function exportReports() {
    const reportsData = {
        todaysSales: getTodaysSales(),
        weekSales: getWeekSales(),
        lowStockCount: getLowStockCount(),
        totalProducts: products.length,
        recentSales: salesHistory.slice(-10),
        generatedAt: new Date().toISOString()
    };

    const dataStr = JSON.stringify(reportsData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});

    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `reports-${new Date().toISOString().split('T')[0]}.json`;
    link.click();

    alert(t('reportsExported'));
}

function exportUsers() {
    if (!hasPermission('users')) {
        alert(t('accessDenied'));
        return;
    }

    const usersData = users.map(user => ({
        id: user.id,
        username: user.username,
        name: user.name,
        role: t(user.role),
        status: user.active ? t('active') : t('inactive')
    }));

    const csvContent = "data:text/csv;charset=utf-8,"
        + [
            [t('id'), t('username'), t('name'), t('role'), t('status')].join(','),
            ...usersData.map(row => Object.values(row).join(','))
        ].join('\n');

    const link = document.createElement('a');
    link.href = encodeURI(csvContent);
    link.download = `users-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();

    alert(t('usersExported'));
}

function resetSettings() {
    if (confirm(t('confirmResetSettings'))) {
        // Reset to default values
        const defaultSettings = {
            taxRate: 0.19,
            companyName: 'My POS System',
            companyAddress: 'Algiers, Algeria',
            companyPhone: '+213 21 123 456',
            receiptFooter: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… - Thank you for your visit!',
            companyLogo: '',
            lowStockThreshold: 10,
            autoBackup: false,
            printAfterSale: false,
            showBarcode: false
        };

        // Update settings object
        Object.assign(settings, defaultSettings);

        // Clear localStorage
        Object.keys(defaultSettings).forEach(key => {
            localStorage.removeItem(key);
        });

        // Refresh settings view
        loadSettingsView();

        // Update main interface
        updateMainLogo();

        alert(t('settingsReset'));
    }
}

function exportData() {
    const allData = {
        products: products,
        salesHistory: salesHistory,
        users: users.map(u => ({...u, password: '***'})), // Hide passwords
        settings: settings,
        exportDate: new Date().toISOString(),
        version: '1.0'
    };

    const dataStr = JSON.stringify(allData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});

    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `pos-data-export-${new Date().toISOString().split('T')[0]}.json`;
    link.click();

    alert(t('dataExported'));
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';

    input.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);

                if (confirm(t('confirmImportData'))) {
                    // Import products (if available)
                    if (importedData.products) {
                        products.splice(0, products.length, ...importedData.products);
                        saveToStorage('products', products);
                    }

                    // Import sales history (if available)
                    if (importedData.salesHistory) {
                        salesHistory.splice(0, salesHistory.length, ...importedData.salesHistory);
                        saveToStorage('salesHistory', salesHistory);
                    }

                    // Import settings (if available)
                    if (importedData.settings) {
                        Object.assign(settings, importedData.settings);
                        Object.keys(importedData.settings).forEach(key => {
                            localStorage.setItem(key, importedData.settings[key]);
                        });
                    }

                    alert(t('dataImported'));
                    location.reload(); // Refresh to apply changes
                }
            } catch (error) {
                alert(t('importError') + ': ' + error.message);
            }
        };
        reader.readAsText(file);
    };

    input.click();
}

function clearAllData() {
    if (confirm(t('confirmClearAllData'))) {
        if (confirm(t('confirmClearAllDataFinal'))) {
            // Clear all data except users (for security)
            products.splice(0, products.length);
            salesHistory.splice(0, salesHistory.length);

            // Save empty arrays
            saveToStorage('products', products);
            saveToStorage('salesHistory', salesHistory);

            // Clear cart
            cart.splice(0, cart.length);

            alert(t('allDataCleared'));
            location.reload();
        }
    }
}

function startCameraScanning() {
    // This function is already implemented above
    // Just ensuring it's available
    console.log('Camera scanning started');
}

function connectUSBScanner() {
    // This function is already implemented above
    // Just ensuring it's available
    console.log('USB scanner connected');
}

// ===== CATEGORIES MANAGEMENT =====

function loadCategoriesView() {
    if (!hasPermission('inventory')) {
        document.getElementById('categories-view').innerHTML = `
            <div class="access-denied">
                <h2>${t('accessDenied')}</h2>
                <p>${t('noPermissionCategories')}</p>
            </div>
        `;
        return;
    }

    const categoriesView = document.getElementById('categories-view');
    categoriesView.innerHTML = `
        <div class="categories-header">
            <h2 data-translate="categoryManagement">${t('categoryManagement')}</h2>
            <div class="categories-actions">
                <button class="btn btn-primary" onclick="showAddCategoryModal()" data-translate="addCategory">${t('addCategory')}</button>
                <button class="btn btn-secondary" onclick="exportCategories()" data-translate="export">${t('export')}</button>
            </div>
        </div>

        <div class="categories-table">
            <table>
                <thead>
                    <tr>
                        <th data-translate="id">${t('id')}</th>
                        <th data-translate="categoryName">${t('categoryName')}</th>
                        <th data-translate="status">${t('status')}</th>
                        <th data-translate="actions">${t('actions')}</th>
                    </tr>
                </thead>
                <tbody>
                    ${generateCategoriesRows()}
                </tbody>
            </table>
        </div>
    `;
}

function generateCategoriesRows() {
    return categories.map(category => `
        <tr class="${category.active ? '' : 'inactive'}">
            <td>${category.id}</td>
            <td>${getCategoryName(category)}</td>
            <td>
                <span class="status-badge ${category.active ? 'active' : 'inactive'}">
                    ${category.active ? t('active') : t('inactive')}
                </span>
            </td>
            <td class="actions">
                <button class="btn-small btn-primary" onclick="editCategory(${category.id})" data-translate="edit">${t('edit')}</button>
                <button class="btn-small ${category.active ? 'btn-warning' : 'btn-success'}"
                        onclick="toggleCategoryStatus(${category.id})">
                    ${category.active ? t('deactivate') : t('activate')}
                </button>
                <button class="btn-small btn-danger" onclick="deleteCategory(${category.id})" data-translate="delete">${t('delete')}</button>
            </td>
        </tr>
    `).join('');
}

function getCategoryName(category) {
    switch(currentLanguage) {
        case 'ar': return category.nameAr || category.name;
        case 'fr': return category.nameFr || category.name;
        case 'es': return category.nameEs || category.name;
        default: return category.name;
    }
}

function showAddCategoryModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 data-translate="addCategory">${t('addCategory')}</h2>
            <form onsubmit="addNewCategory(event)">
                <div class="form-group">
                    <label data-translate="englishName">${t('englishName')}:</label>
                    <input type="text" id="category-name-en" required>
                </div>
                <div class="form-group">
                    <label data-translate="arabicName">${t('arabicName')}:</label>
                    <input type="text" id="category-name-ar" required>
                </div>
                <div class="form-group">
                    <label data-translate="frenchName">${t('frenchName')}:</label>
                    <input type="text" id="category-name-fr" required>
                </div>
                <div class="form-group">
                    <label data-translate="spanishName">${t('spanishName')}:</label>
                    <input type="text" id="category-name-es" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" data-translate="cancel">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary" data-translate="save">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function addNewCategory(event) {
    event.preventDefault();

    const newCategory = {
        id: Math.max(...categories.map(c => c.id)) + 1,
        name: document.getElementById('category-name-en').value,
        nameAr: document.getElementById('category-name-ar').value,
        nameFr: document.getElementById('category-name-fr').value,
        nameEs: document.getElementById('category-name-es').value,
        active: true
    };

    categories.push(newCategory);
    saveToStorage('categories', categories);

    closeModal();
    loadCategoriesView();

    // Refresh product categories
    updateProductCategories();

    alert(`${t('category')} "${getCategoryName(newCategory)}" ${t('addedSuccessfully')}!`);
}

function editCategory(categoryId) {
    const category = categories.find(c => c.id === categoryId);
    if (!category) return;

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 data-translate="editCategory">${t('editCategory')}</h2>
            <form onsubmit="updateCategory(event, ${categoryId})">
                <div class="form-group">
                    <label data-translate="englishName">${t('englishName')}:</label>
                    <input type="text" id="edit-category-name-en" value="${category.name}" required>
                </div>
                <div class="form-group">
                    <label data-translate="arabicName">${t('arabicName')}:</label>
                    <input type="text" id="edit-category-name-ar" value="${category.nameAr}" required>
                </div>
                <div class="form-group">
                    <label data-translate="frenchName">${t('frenchName')}:</label>
                    <input type="text" id="edit-category-name-fr" value="${category.nameFr}" required>
                </div>
                <div class="form-group">
                    <label data-translate="spanishName">${t('spanishName')}:</label>
                    <input type="text" id="edit-category-name-es" value="${category.nameEs}" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" data-translate="cancel">${t('cancel')}</button>
                    <button type="submit" class="btn btn-primary" data-translate="save">${t('save')}</button>
                </div>
            </form>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateCategory(event, categoryId) {
    event.preventDefault();

    const category = categories.find(c => c.id === categoryId);
    if (!category) return;

    category.name = document.getElementById('edit-category-name-en').value;
    category.nameAr = document.getElementById('edit-category-name-ar').value;
    category.nameFr = document.getElementById('edit-category-name-fr').value;
    category.nameEs = document.getElementById('edit-category-name-es').value;

    saveToStorage('categories', categories);

    closeModal();
    loadCategoriesView();

    // Refresh product categories
    updateProductCategories();

    alert(`${t('category')} "${getCategoryName(category)}" ${t('updatedSuccessfully')}!`);
}

function toggleCategoryStatus(categoryId) {
    const category = categories.find(c => c.id === categoryId);
    if (!category) return;

    category.active = !category.active;
    saveToStorage('categories', categories);

    loadCategoriesView();

    // Refresh product categories
    updateProductCategories();

    alert(`${t('category')} "${getCategoryName(category)}" ${category.active ? t('activated') : t('deactivated')} ${t('successfully')}!`);
}

function deleteCategory(categoryId) {
    const category = categories.find(c => c.id === categoryId);
    if (!category) return;

    // Check if category is used by products
    const productsUsingCategory = products.filter(p => p.category === category.name.toLowerCase());
    if (productsUsingCategory.length > 0) {
        alert(`${t('cannotDeleteCategory')} "${getCategoryName(category)}" - ${productsUsingCategory.length} ${t('productsUsingCategory')}`);
        return;
    }

    if (confirm(`${t('confirmDeleteCategory')} "${getCategoryName(category)}"?`)) {
        const index = categories.findIndex(c => c.id === categoryId);
        categories.splice(index, 1);
        saveToStorage('categories', categories);

        loadCategoriesView();

        // Refresh product categories
        updateProductCategories();

        alert(`${t('category')} "${getCategoryName(category)}" ${t('deletedSuccessfully')}!`);
    }
}

function exportCategories() {
    const categoriesData = categories.map(category => ({
        id: category.id,
        name: category.name,
        nameAr: category.nameAr,
        nameFr: category.nameFr,
        nameEs: category.nameEs,
        status: category.active ? t('active') : t('inactive')
    }));

    const csvContent = "data:text/csv;charset=utf-8,"
        + [
            ['ID', 'English', 'Arabic', 'French', 'Spanish', t('status')].join(','),
            ...categoriesData.map(row => Object.values(row).join(','))
        ].join('\n');

    const link = document.createElement('a');
    link.href = encodeURI(csvContent);
    link.download = `categories-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();

    alert(t('categoriesExported'));
}

function updateProductCategories() {
    // Refresh product display if on sales tab
    if (currentView === 'sales') {
        displayProducts();
    }

    // Refresh inventory if on inventory tab
    if (currentView === 'inventory') {
        loadInventoryView();
    }
}

// ===== CHARTS FUNCTIONALITY =====

let chartsVisible = false;
let salesChart = null;
let productChart = null;

function toggleCharts() {
    const chartsSection = document.getElementById('charts-section');
    chartsVisible = !chartsVisible;

    if (chartsVisible) {
        chartsSection.style.display = 'block';
        // Load Chart.js if not already loaded
        if (typeof Chart === 'undefined') {
            loadChartJS(() => initializeCharts());
        } else {
            initializeCharts();
        }
    } else {
        chartsSection.style.display = 'none';
        destroyCharts();
    }
}

function loadChartJS(callback) {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    script.onload = callback;
    document.head.appendChild(script);
}

function initializeCharts() {
    // Small delay to ensure Chart.js is fully loaded
    setTimeout(() => {
        initializeSalesChart();
        initializeProductChart();
    }, 100);
}

function destroyCharts() {
    if (salesChart) {
        salesChart.destroy();
        salesChart = null;
    }
    if (productChart) {
        productChart.destroy();
        productChart = null;
    }
}

function initializeSalesChart() {
    const ctx = document.getElementById('salesChart');
    if (!ctx || typeof Chart === 'undefined') return;

    // Get last 7 days of sales data
    const last7Days = [];
    const salesData = [];

    for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();

        last7Days.push(date.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US'));

        const dayTotal = salesHistory
            .filter(sale => new Date(sale.date).toDateString() === dateStr)
            .reduce((sum, sale) => sum + sale.total, 0);

        salesData.push(dayTotal);
    }

    salesChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: last7Days,
            datasets: [{
                label: t('dailySales'),
                data: salesData,
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: t('salesChart')
                },
                legend: {
                    display: true
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        }
                    }
                }
            }
        }
    });
}

function initializeProductChart() {
    const ctx = document.getElementById('productChart');
    if (!ctx || typeof Chart === 'undefined') return;

    // Get top 5 selling products
    const productSales = {};

    salesHistory.forEach(sale => {
        sale.items.forEach(item => {
            if (!productSales[item.id]) {
                productSales[item.id] = {
                    name: getProductName(item),
                    quantity: 0
                };
            }
            productSales[item.id].quantity += item.quantity;
        });
    });

    const sortedProducts = Object.values(productSales)
        .sort((a, b) => b.quantity - a.quantity)
        .slice(0, 5);

    const labels = sortedProducts.map(p => p.name);
    const data = sortedProducts.map(p => p.quantity);

    productChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                label: t('productsSold'),
                data: data,
                backgroundColor: [
                    '#667eea',
                    '#764ba2',
                    '#f093fb',
                    '#f5576c',
                    '#4facfe'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: t('topSellingProducts')
                },
                legend: {
                    display: true,
                    position: 'bottom'
                }
            }
        }
    });
}

// ===== LOGO MANAGEMENT =====

function handleLogoUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    // Validate file type
    if (!file.type.startsWith('image/')) {
        alert(t('invalidFileType'));
        return;
    }

    // Validate file size (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
        alert(t('fileTooLarge'));
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const logoData = e.target.result;

        // Update settings
        settings.companyLogo = logoData;
        localStorage.setItem('companyLogo', logoData);

        // Update preview
        updateLogoPreview(logoData);

        // Update main interface logo
        updateMainLogo();

        alert(t('logoUpdated'));
    };

    reader.readAsDataURL(file);
}

function removeLogo() {
    if (confirm(t('confirmRemoveLogo'))) {
        settings.companyLogo = '';
        localStorage.removeItem('companyLogo');

        // Update preview
        updateLogoPreview('');

        // Update main interface
        updateMainLogo();

        // Refresh settings view
        loadSettingsView();

        alert(t('logoRemoved'));
    }
}

function updateLogoPreview(logoData) {
    const preview = document.getElementById('current-logo-preview');
    if (preview) {
        if (logoData) {
            preview.src = logoData;
            preview.style.display = 'block';
        } else {
            preview.style.display = 'none';
        }
    }
}

function updateMainLogo() {
    // Update logo in main interface
    const mainLogo = document.getElementById('main-logo');
    if (mainLogo) {
        if (settings.companyLogo) {
            mainLogo.innerHTML = `<img src="${settings.companyLogo}" alt="${settings.companyName}" style="max-height: 40px;">`;
        } else {
            mainLogo.innerHTML = `<span style="font-weight: bold; color: var(--primary-color);">${settings.companyName}</span>`;
        }
    }

    // Update logo in receipts and invoices (will be used in next print)
    // The logo will automatically appear in printed documents
}

// ===== PRODUCT MANAGEMENT =====

function displayProducts() {
    const filteredProducts = currentCategory === 'all'
        ? products.filter(p => p.active)
        : products.filter(p => p.category === currentCategory && p.active);

    const productsGrid = document.getElementById('products-grid');
    if (!productsGrid) return;

    productsGrid.innerHTML = '';

    filteredProducts.forEach(product => {
        const productName = getProductName(product);
        const isLowStock = product.stock <= product.minStock;
        const isExpired = product.expiryDate && new Date(product.expiryDate) < new Date();
        const isNearExpiry = product.expiryDate && new Date(product.expiryDate) <= new Date(Date.now() + 3 * 24 * 60 * 60 * 1000);

        let statusClass = '';
        let statusBadge = '';

        if (isExpired) {
            statusClass = 'expired';
            statusBadge = `<span class="expired-badge">âš ï¸ ${t('expired')}</span>`;
        } else if (isNearExpiry) {
            statusClass = 'near-expiry';
            statusBadge = `<span class="near-expiry-badge">â° ${t('nearExpiry')}</span>`;
        } else if (isLowStock) {
            statusClass = 'low-stock';
            statusBadge = `<span class="low-stock-badge">ğŸ“¦ ${t('lowStock')}</span>`;
        }

        const productCard = document.createElement('div');
        productCard.className = `product-card ${statusClass}`;
        productCard.innerHTML = `
            ${product.image ? `<div class="product-image"><img src="${product.image}" alt="${productName}" /></div>` : ''}
            <div class="product-info">
                <h3>${productName}</h3>
                <div class="price">${formatCurrency(product.price)}</div>
                <div class="stock-info">
                    <span class="stock-count">${t('stock')}: ${product.stock}</span>
                    ${statusBadge}
                </div>
                ${product.expiryDate ? `<div class="expiry-date">${t('expiryDate')}: ${new Date(product.expiryDate).toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US')}</div>` : ''}
                ${settings.showBarcode ? `<div class="barcode">${product.barcode}</div>` : ''}
            </div>
        `;

        // Don't allow adding expired products to cart
        if (!isExpired) {
            productCard.addEventListener('click', () => addToCart(product));
        } else {
            productCard.style.cursor = 'not-allowed';
            productCard.style.opacity = '0.6';
        }

        productsGrid.appendChild(productCard);
    });
}

function searchProducts() {
    const searchTerm = document.getElementById('product-search').value.toLowerCase();
    const filteredProducts = products.filter(product => {
        const name = (currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name).toLowerCase();
        const barcode = product.barcode.toLowerCase();
        return product.active && (name.includes(searchTerm) || barcode.includes(searchTerm));
    });

    displayFilteredProducts(filteredProducts);
}

function displayFilteredProducts(filteredProducts) {
    const productsGrid = document.getElementById('products-grid');
    if (!productsGrid) return;

    productsGrid.innerHTML = '';

    filteredProducts.forEach(product => {
        const productName = currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name;
        const isLowStock = product.stock <= product.minStock;

        const productCard = document.createElement('div');
        productCard.className = `product-card ${isLowStock ? 'low-stock' : ''}`;
        productCard.innerHTML = `
            <div class="product-info">
                <h3>${productName}</h3>
                <div class="price">${formatCurrency(product.price)}</div>
                <div class="stock-info">
                    <span class="stock-count">${t('stock')}: ${product.stock}</span>
                    ${isLowStock ? '<span class="low-stock-badge">âš ï¸ Low</span>' : ''}
                </div>
                ${settings.showBarcode ? `<div class="barcode">${product.barcode}</div>` : ''}
            </div>
        `;

        productCard.addEventListener('click', () => addToCart(product));
        productsGrid.appendChild(productCard);
    });
}

// ===== CART MANAGEMENT =====

function addToCart(product) {
    if (product.stock <= 0) {
        alert(`${product.name} is out of stock!`);
        return;
    }

    const existingItem = cart.find(item => item.id === product.id);

    if (existingItem) {
        if (existingItem.quantity >= product.stock) {
            alert(`Cannot add more ${product.name}. Only ${product.stock} in stock.`);
            return;
        }
        existingItem.quantity += 1;
    } else {
        cart.push({
            ...product,
            quantity: 1
        });
    }

    updateCartDisplay();
    saveCart();
}

function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateCartDisplay();
    saveCart();
}

function updateQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    const product = products.find(p => p.id === productId);

    if (item && product) {
        const newQuantity = item.quantity + change;

        if (newQuantity <= 0) {
            removeFromCart(productId);
        } else if (newQuantity > product.stock) {
            alert(`Cannot add more ${product.name}. Only ${product.stock} in stock.`);
        } else {
            item.quantity = newQuantity;
            updateCartDisplay();
            saveCart();
        }
    }
}

function updateCartDisplay() {
    const cartItemsEl = document.getElementById('cart-items');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');

    if (!cartItemsEl) return;

    if (cart.length === 0) {
        cartItemsEl.innerHTML = `<p class="empty-cart" data-translate="emptyCart">${t('emptyCart')}</p>`;
    } else {
        cartItemsEl.innerHTML = cart.map(item => {
            const itemName = currentLanguage === 'ar' && item.nameAr ? item.nameAr : item.name;
            return `
                <div class="cart-item">
                    <div class="item-info">
                        <div class="item-name">${itemName}</div>
                        <div class="item-price">${formatCurrency(item.price)} each</div>
                    </div>
                    <div class="quantity-controls">
                        <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <span class="quantity">${item.quantity}</span>
                        <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                        <button class="remove-btn" onclick="removeFromCart(${item.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    updateTotals();
}

function updateTotals() {
    const subtotal = cart.reduce((sum, item) => sum + (convertPrice(item.price) * item.quantity), 0);
    const tax = subtotal * settings.taxRate;
    const total = subtotal + tax;

    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');

    if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal / currencies[currentCurrency].rate);
    if (taxEl) taxEl.textContent = formatCurrency(tax / currencies[currentCurrency].rate);
    if (totalEl) totalEl.textContent = formatCurrency(total / currencies[currentCurrency].rate);
}

function clearCart() {
    if (cart.length > 0 && confirm(`${t('clearCart')}?`)) {
        cart = [];
        updateCartDisplay();
        saveCart();
    }
}

function saveCart() {
    saveToStorage('currentCart', cart);
}

function loadCart() {
    const savedCart = loadFromStorage('currentCart', []);
    cart = savedCart;
    updateCartDisplay();
}

// ===== CHECKOUT & PAYMENT SYSTEM =====

function openCheckout() {
    if (cart.length === 0) {
        alert(t('emptyCart'));
        return;
    }

    const modal = document.getElementById('checkout-modal');
    const checkoutItems = document.getElementById('checkout-items');
    const checkoutTotal = document.getElementById('checkout-total-amount');

    // Display checkout items
    const subtotal = cart.reduce((sum, item) => sum + (convertPrice(item.price) * item.quantity), 0);
    const tax = subtotal * settings.taxRate;
    const total = subtotal + tax;

    checkoutItems.innerHTML = cart.map(item => {
        const itemName = currentLanguage === 'ar' && item.nameAr ? item.nameAr : item.name;
        return `
            <div class="checkout-item">
                <span>${itemName} x ${item.quantity}</span>
                <span>${formatCurrency((item.price * item.quantity) / currencies[currentCurrency].rate)}</span>
            </div>
        `;
    }).join('');

    checkoutTotal.textContent = formatCurrency(total / currencies[currentCurrency].rate);

    modal.style.display = 'block';
}

function closeCheckout() {
    const modal = document.getElementById('checkout-modal');
    modal.style.display = 'none';
    document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('active'));
}

function completeSale() {
    const selectedPayment = document.querySelector('.payment-btn.active');

    if (!selectedPayment) {
        alert('Please select a payment method');
        return;
    }

    const paymentMethod = selectedPayment.dataset.method;
    const subtotal = cart.reduce((sum, item) => sum + (convertPrice(item.price) * item.quantity), 0);
    const tax = subtotal * settings.taxRate;
    const total = subtotal + tax;

    // Create sale record
    const sale = {
        id: generateId(),
        date: new Date().toISOString(),
        cashier: currentUser.name,
        items: [...cart],
        subtotal: subtotal / currencies[currentCurrency].rate,
        tax: tax / currencies[currentCurrency].rate,
        total: total / currencies[currentCurrency].rate,
        paymentMethod: paymentMethod,
        currency: currentCurrency
    };

    // Update inventory
    cart.forEach(cartItem => {
        const product = products.find(p => p.id === cartItem.id);
        if (product) {
            product.stock -= cartItem.quantity;
        }
    });

    // Save sale
    salesHistory.push(sale);
    saveToStorage('salesHistory', salesHistory);
    saveToStorage('products', products);

    // Print receipt if enabled
    if (settings.printAfterSale) {
        printReceipt(sale);
    }

    // Show success message
    alert(`${t('checkout')} ${t('completed')}!\n${t('total')}: ${formatCurrency(total / currencies[currentCurrency].rate)}\n${t('paymentMethod')}: ${paymentMethod}`);

    // Clear cart and close modal
    cart = [];
    updateCartDisplay();
    displayProducts(); // Refresh to show updated stock
    closeCheckout();
    saveCart();
}

// ===== PRINTING SYSTEM =====

function printReceipt(sale = null) {
    if (!sale && cart.length === 0) {
        alert('No items to print');
        return;
    }

    let receiptData;
    if (sale) {
        receiptData = sale;
    } else {
        // Create temporary sale data for current cart
        const subtotal = cart.reduce((sum, item) => sum + (convertPrice(item.price) * item.quantity), 0);
        const tax = subtotal * settings.taxRate;
        const total = subtotal + tax;

        receiptData = {
            id: 'TEMP-' + Date.now(),
            date: new Date().toISOString(),
            cashier: currentUser.name,
            items: [...cart],
            subtotal: subtotal / currencies[currentCurrency].rate,
            tax: tax / currencies[currentCurrency].rate,
            total: total / currencies[currentCurrency].rate,
            paymentMethod: 'N/A',
            currency: currentCurrency
        };
    }

    const receiptWindow = window.open('', '_blank');
    const receiptHTML = generateReceiptHTML(receiptData);

    receiptWindow.document.write(receiptHTML);
    receiptWindow.document.close();
    receiptWindow.focus();
    receiptWindow.print();
}

function generateReceiptHTML(sale) {
    const date = new Date(sale.date);
    const formattedDate = date.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : 'en-US');
    const formattedTime = date.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-DZ' : 'en-US');

    return `
        <!DOCTYPE html>
        <html dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}">
        <head>
            <meta charset="UTF-8">
            <title>Receipt - ${sale.id}</title>
            <style>
                body {
                    font-family: 'Courier New', monospace;
                    max-width: 300px;
                    margin: 0 auto;
                    padding: 10px;
                    font-size: 12px;
                    line-height: 1.4;
                }
                .header { text-align: center; margin-bottom: 20px; }
                .company-name { font-size: 16px; font-weight: bold; }
                .separator { border-top: 1px dashed #000; margin: 10px 0; }
                .item-line { display: flex; justify-content: space-between; margin: 5px 0; }
                .total-line { font-weight: bold; }
                .footer { text-align: center; margin-top: 20px; font-size: 10px; }
                @media print {
                    body { margin: 0; padding: 5px; }
                }
            </style>
        </head>
        <body>
            <div class="header">
                <div class="company-name">${settings.companyName}</div>
                <div>${settings.companyAddress}</div>
                <div>${settings.companyPhone}</div>
            </div>

            <div class="separator"></div>

            <div class="receipt-info">
                <div>Receipt #: ${sale.id}</div>
                <div>Date: ${formattedDate} ${formattedTime}</div>
                <div>Cashier: ${sale.cashier}</div>
                <div>Currency: ${currencies[sale.currency].name}</div>
            </div>

            <div class="separator"></div>

            <div class="items">
                ${sale.items.map(item => {
                    const itemName = currentLanguage === 'ar' && item.nameAr ? item.nameAr : item.name;
                    const itemTotal = item.price * item.quantity;
                    return `
                        <div class="item-line">
                            <span>${itemName}</span>
                        </div>
                        <div class="item-line">
                            <span>${item.quantity} x ${formatCurrency(item.price)}</span>
                            <span>${formatCurrency(itemTotal)}</span>
                        </div>
                    `;
                }).join('')}
            </div>

            <div class="separator"></div>

            <div class="totals">
                <div class="item-line">
                    <span>Subtotal:</span>
                    <span>${formatCurrency(sale.subtotal)}</span>
                </div>
                <div class="item-line">
                    <span>Tax (${(settings.taxRate * 100).toFixed(0)}%):</span>
                    <span>${formatCurrency(sale.tax)}</span>
                </div>
                <div class="item-line total-line">
                    <span>TOTAL:</span>
                    <span>${formatCurrency(sale.total)}</span>
                </div>
            </div>

            <div class="separator"></div>

            <div class="payment-info">
                <div>Payment Method: ${sale.paymentMethod}</div>
            </div>

            <div class="footer">
                <div>${settings.receiptFooter}</div>
                <div>Powered by Professional POS System</div>
            </div>
        </body>
        </html>
    `;
}

// ===== LOW STOCK MANAGEMENT =====

function checkLowStock() {
    const lowStockProducts = products.filter(product =>
        product.active && product.stock <= product.minStock
    );

    const alertDiv = document.getElementById('low-stock-alert');
    const itemsDiv = document.getElementById('low-stock-items');

    if (lowStockProducts.length > 0) {
        alertDiv.style.display = 'block';
        itemsDiv.innerHTML = lowStockProducts.map(product => {
            const productName = currentLanguage === 'ar' && product.nameAr ? product.nameAr : product.name;
            return `<div class="low-stock-item">${productName}: ${product.stock} left (Min: ${product.minStock})</div>`;
        }).join('');
    } else {
        alertDiv.style.display = 'none';
    }
}

// ===== UTILITY FUNCTIONS =====

function updateTime() {
    const timeEl = document.getElementById('current-time');
    if (timeEl) {
        const now = new Date();
        const timeString = now.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-DZ' : 'en-US');
        const dateString = now.toLocaleDateString(currentLanguage === 'ar' ? 'ar-DZ' : 'en-US');
        timeEl.textContent = `${dateString} ${timeString}`;
    }
}

function setupEventListeners() {
    // Category buttons
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentCategory = this.dataset.category;
            displayProducts();
        });
    });

    // Cart actions
    const clearCartBtn = document.getElementById('clear-cart');
    const checkoutBtn = document.getElementById('checkout');
    const printReceiptBtn = document.getElementById('print-receipt');
    const printInvoiceBtn = document.getElementById('print-invoice');
    const cancelCheckoutBtn = document.getElementById('cancel-checkout');
    const completeSaleBtn = document.getElementById('complete-sale');

    if (clearCartBtn) clearCartBtn.addEventListener('click', clearCart);
    if (checkoutBtn) checkoutBtn.addEventListener('click', openCheckout);
    if (printReceiptBtn) printReceiptBtn.addEventListener('click', () => printReceipt());
    if (printInvoiceBtn) printInvoiceBtn.addEventListener('click', () => printInvoice());
    if (cancelCheckoutBtn) cancelCheckoutBtn.addEventListener('click', closeCheckout);
    if (completeSaleBtn) completeSaleBtn.addEventListener('click', completeSale);

    // Payment method buttons
    document.querySelectorAll('.payment-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.payment-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Close modal when clicking outside
    const checkoutModal = document.getElementById('checkout-modal');
    if (checkoutModal) {
        checkoutModal.addEventListener('click', function(e) {
            if (e.target === checkoutModal) {
                closeCheckout();
            }
        });
    }
}

function loadSettings() {
    // Settings are already loaded in the settings object
    // This function can be extended to load from server/database
}

function autoSave() {
    saveToStorage('products', products);
    saveToStorage('salesHistory', salesHistory);
    saveToStorage('settings', settings);
}

// ===== ENHANCED BARCODE SCANNING =====

let barcodeBuffer = '';
let barcodeTimeout;
let scannerConnected = false;

// Enhanced barcode scanning with hardware support
function scanBarcode() {
    // Check if we have camera access for mobile scanning
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        showBarcodeScanModal();
    } else {
        // Fallback to manual entry
        manualBarcodeEntry();
    }
}

function manualBarcodeEntry() {
    const barcode = prompt(t('enterBarcode') + ':');
    if (barcode) {
        processBarcodeInput(barcode.trim());
    }
}

function showBarcodeScanModal() {
    const modal = document.createElement('div');
    modal.className = 'modal barcode-modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content barcode-scan-content">
            <h2>${t('scanBarcode')}</h2>
            <div class="scan-options">
                <button class="btn btn-primary" onclick="startCameraScanning()">${t('useCamera')}</button>
                <button class="btn btn-secondary" onclick="manualBarcodeEntry(); closeModal()">${t('manualEntry')}</button>
                <button class="btn btn-info" onclick="connectUSBScanner()">${t('connectScanner')}</button>
            </div>
            <div id="camera-container" style="display: none;">
                <video id="camera-preview" autoplay playsinline></video>
                <div class="scan-overlay">
                    <div class="scan-line"></div>
                </div>
                <div class="scan-instructions">${t('pointCameraAtBarcode')}</div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">${t('cancel')}</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// Process barcode input from any source
function processBarcodeInput(barcode) {
    console.log('Processing barcode:', barcode);

    // Find product by barcode
    const product = findProductByBarcode(barcode);

    if (product) {
        addToCart(product);
        showBarcodeSuccess(product);
    } else {
        showBarcodeError(barcode);
    }
}

function findProductByBarcode(barcode) {
    return products.find(p =>
        p.active && (
            p.barcode === barcode ||
            p.barcode === barcode.replace(/^0+/, '') || // Remove leading zeros
            barcode.includes(p.barcode) ||
            p.name.toLowerCase().includes(barcode.toLowerCase()) ||
            (p.nameAr && p.nameAr.includes(barcode)) ||
            (p.nameFr && p.nameFr.toLowerCase().includes(barcode.toLowerCase())) ||
            (p.nameEs && p.nameEs.toLowerCase().includes(barcode.toLowerCase()))
        )
    );
}

function showBarcodeSuccess(product) {
    const productName = getProductName(product);
    alert(`âœ… ${t('productAdded')}: ${productName} - ${formatCurrency(product.price)}`);
}

function showBarcodeError(barcode) {
    alert(`âŒ ${t('productNotFound')}: ${barcode}`);
}

// Make functions globally available
window.handleLogin = handleLogin;
window.changeLanguage = changeLanguage;
window.changeCurrency = changeCurrency;
window.logout = logout;
window.switchView = switchView;
window.searchProducts = searchProducts;
window.addToCart = addToCart;
window.removeFromCart = removeFromCart;
window.updateQuantity = updateQuantity;
window.clearCart = clearCart;
window.openCheckout = openCheckout;
window.closeCheckout = closeCheckout;
window.completeSale = completeSale;
window.printReceipt = printReceipt;
window.scanBarcode = scanBarcode;

// Inventory functions
window.filterInventory = filterInventory;
window.showAddProductModal = showAddProductModal;
window.addNewProduct = addNewProduct;
window.editProduct = editProduct;
window.updateProduct = updateProduct;
window.adjustStock = adjustStock;
window.deleteProduct = deleteProduct;
window.closeModal = closeModal;

// Reports functions
window.generateDailyReport = generateDailyReport;
window.generateWeeklyReport = generateWeeklyReport;

// Users functions
window.showAddUserModal = showAddUserModal;
window.addNewUser = addNewUser;
window.editUser = editUser;
window.updateUser = updateUser;
window.toggleUserStatus = toggleUserStatus;
window.deleteUser = deleteUser;

// Settings functions
window.saveSettings = saveSettings;
window.createBackup = createBackup;

// Printing functions
window.printInvoice = printInvoice;
window.printLowStockReport = printLowStockReport;
window.printExpiredItemsReport = printExpiredItemsReport;

// Logo functions
window.handleLogoUpload = handleLogoUpload;
window.removeLogo = removeLogo;

// Export/Import functions
window.exportInventory = exportInventory;
window.exportReports = exportReports;
window.exportUsers = exportUsers;
window.resetSettings = resetSettings;
window.exportData = exportData;
window.importData = importData;
window.clearAllData = clearAllData;

// Scanner functions
window.startCameraScanning = startCameraScanning;
window.connectUSBScanner = connectUSBScanner;

// Categories functions
window.loadCategoriesView = loadCategoriesView;
window.showAddCategoryModal = showAddCategoryModal;
window.addNewCategory = addNewCategory;
window.editCategory = editCategory;
window.updateCategory = updateCategory;
window.toggleCategoryStatus = toggleCategoryStatus;
window.deleteCategory = deleteCategory;
window.exportCategories = exportCategories;

// Charts functions
window.toggleCharts = toggleCharts;
